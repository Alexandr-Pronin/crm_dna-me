<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 56c2c73b-a95c-477a-b326-eecef3f40634 (2026-01-22 13:20Z) -->

# EventTimeline Komponente Entwicklung (2026-01-22 13:20Z)

_**User (2026-01-22 13:06Z)**_

Implement the following to-dos from the plan (the plan is attached for your reference). Do NOT edit the plan file itself.

You have been assigned the following 1 to-do(s) with IDs: event-timeline

1. [event-timeline] EventTimeline Komponente erstellen mit Event-Icons und expandierbarer Metadata

These to-dos have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the assigned to-dos.

---

_**Agent (model claude-4.5-opus-high-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
Der Benutzer möchte, dass ich die EventTimeline-Komponente implementiere. Laut dem Plan soll diese:
- Chronologische Event-Liste
- Event Type Icons und Badges
- Expandable Metadata
- Source-Anzeige

Ich muss zuerst den bestehenden Code analysieren, um zu verstehen:
1. Wie die bestehende Frontend-Struktur aussieht
2. Welche API-Endpoints für Events verfügbar sind
3. Wie der DataProvider aufgebaut ist
4. Welche UI-Komponenten bereits existieren

Lass mich zuerst die relevanten Dateien lesen.</details></think>

---

Ich werde die EventTimeline-Komponente implementieren. Zuerst markiere ich die Aufgabe als in Bearbeitung und analysiere den bestehenden Code.

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] EventTimeline Komponente erstellen mit Event-Icons und expandierbarer Metadata

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: e:\dname\crm_dna-me\frontend\src\providers\dataProvider.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: e:\dname\crm_dna-me\frontend\src\resources\leads\LeadShow.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Gut, ich habe jetzt den Code gesehen. Der DataProvider hat bereits `getLeadEvents` implementiert. Die LeadShow.jsx hat ein Tab-System, aber nur für "Overview" und "Score History". Ich muss:

1. Eine EventTimeline Komponente erstellen
2. Diese in LeadShow.jsx als dritten Tab hinzufügen

Lass mich zuerst die vorhandene ScoreHistory-Komponente ansehen, um den Stil zu verstehen:</details></think>

---

Ich sehe den bestehenden Code. Der DataProvider hat bereits `getLeadEvents` implementiert. Ich muss jetzt die EventTimeline-Komponente erstellen. Zuerst schaue ich mir die vorhandene ScoreHistory-Komponente an, um den Stil zu verstehen:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: e:\dname\crm_dna-me\frontend\src\resources\leads\components\ScoreHistory.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: e:\dname\crm_dna-me\frontend\src\resources\leads\components\index.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt habe ich ein gutes Verständnis der bestehenden Komponenten:1. Die ScoreHistory-Komponente ist gut strukturiert mit Timeline-Einträgen
2. Die Komponenten verwenden Material-UI
3. date-fns wird für Datumsformatierung verwendet
4. Der DataProvider hat bereits `getLeadEvents` - dieser gibt die Lead-Events zurückJetzt muss ich prüfen, welche Daten das Backend für Events liefert. Ich sollte die Backend-API anschauen, um zu verstehen, welche Event-Typen und Metadaten verfügbar sind.

Laut dem Plan soll die EventTimeline-Komponente:
- Chronologische Event-Liste
- Event Type Icons und Badges
- Expandable Metadata
- Source-Anzeige

Ich werde die EventTimeline-Komponente erstellen, die den gleichen Stil wie ScoreHistory verwendet, aber für Marketing-Events optimiert ist.

Zuerst schaue ich mir die Backend-Events-API an, um das Format zu verstehen:</details></think>

---

Jetzt verstehe ich den Stil. Ich schaue mir noch das Backend an, um das Event-Datenformat zu verstehen:

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "What is the structure of lead events and event types in the API?" • **12** results</summary>
            
| File | Lines |
|------|-------|
| `src/api/schemas/events.ts` | L35-85 |
| `src/api/schemas/events.ts` | L145-205 |
| `src/api/routes/events.ts` | L23-355 |
| `src/types/index.ts` | L97-154 |
| `src/types/index.ts` | L294-324 |
| `src/api/routes/leads.ts` | L99-808 |
| `src/api/schemas/events.ts` | L26 |
| `src/api/routes/leads.ts` | L27-42 |
| `src/types/index.ts` | L36-95 |
| `src/api/schemas/leads.ts` | L155-217 |
| `src/services/leadService.ts` | L23-653 |
| `src/api/routes/events.ts` | L21 |

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ich habe jetzt eine gute Übersicht über die Event-Struktur. Die MarketingEvent-Interface zeigt:- id: string- lead_id?: string- event_type: string- event_category?: string- source: string- occurred_at: Date- metadata: Record<string, unknown>- campaign_id?: string- utm_source?: string- utm_medium?: string- utm_campaign?: string- correlation_id?: string- score_points: number- score_category?: string- processed_at?: Date- created_at: Date

Die Sources sind:
- waalaxy
- portal
- lemlist
- ads
- conference
- website
- linkedin
- manual
- api
- import

Und die Event-Typen sind vielfältig (page_visited, email_opened, etc.)

Jetzt werde ich die EventTimeline-Komponente erstellen. Ich werde:
1. EventTimeline.jsx im components-Verzeichnis erstellen
2. Den index.js aktualisieren, um EventTimeline zu exportieren
3. LeadShow.jsx erweitern, um einen dritten Tab für Events hinzuzufügen</details></think>

---

Jetzt habe ich alle Informationen. Ich werde die EventTimeline-Komponente erstellen:

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: e:\dname\crm_dna-me\frontend\src\resources\leads\components\EventTimeline.jsx</summary>

**Chunk 1**
Lines added: 773, lines removed: 1

```diff
@@ -1,1 +1,773 @@
- 
+ /**
+  * Event Timeline Component
+  * Chronological timeline of marketing events with expandable metadata
+  */
+ import { useState, useEffect } from 'react';
+ import {
+   Box,
+   Card,
+   CardContent,
+   Typography,
+   Chip,
+   ToggleButton,
+   ToggleButtonGroup,
+   CircularProgress,
+   Alert,
+   Tooltip,
+   Collapse,
+   IconButton,
+ } from '@mui/material';
+ import {
+   // Event Type Icons
+   Web as WebIcon,
+   Email as EmailIcon,
+   LinkedIn as LinkedInIcon,
+   Handshake as SalesIcon,
+   Campaign as AdsIcon,
+   Event as ConferenceIcon,
+   CloudUpload as ApiIcon,
+   Edit as ManualIcon,
+   Upload as ImportIcon,
+   // Generic Icons
+   Schedule as ScheduleIcon,
+   FilterList as FilterIcon,
+   ExpandMore as ExpandMoreIcon,
+   ExpandLess as ExpandLessIcon,
+   Source as SourceIcon,
+   // Event Action Icons
+   Visibility as PageViewIcon,
+   Description as FormIcon,
+   Download as DownloadIcon,
+   PlayCircle as VideoIcon,
+   Send as SendIcon,
+   MarkEmailRead as OpenedIcon,
+   TouchApp as ClickedIcon,
+   Reply as ReplyIcon,
+   PersonAdd as ConnectionIcon,
+   Check as AcceptedIcon,
+   Message as MessageIcon,
+   CalendarMonth as MeetingIcon,
+   Phone as CallIcon,
+   RequestQuote as ProposalIcon,
+   Gavel as ContractIcon,
+   ThumbUp as WonIcon,
+   ThumbDown as LostIcon,
+   PersonAddAlt as RegisteredIcon,
+   ShoppingCart as OrderIcon,
+   CreditCard as SubscriptionIcon,
+ } from '@mui/icons-material';
+ import { format, formatDistanceToNow, parseISO, isValid } from 'date-fns';
+ import { de } from 'date-fns/locale';
+ import { getLeadEvents } from '../../../providers/dataProvider';
+ 
+ // Source configuration with colors and icons
+ const SOURCE_CONFIG = {
+   waalaxy: {
+     label: 'Waalaxy',
+     color: '#FF6B35',
+     bgColor: '#FF6B3520',
+     icon: LinkedInIcon,
+   },
+   portal: {
+     label: 'Portal',
+     color: '#4A90A4',
+     bgColor: '#4A90A420',
+     icon: WebIcon,
+   },
+   lemlist: {
+     label: 'Lemlist',
+     color: '#9B59B6',
+     bgColor: '#9B59B620',
+     icon: EmailIcon,
+   },
+   ads: {
+     label: 'Ads',
+     color: '#F1C40F',
+     bgColor: '#F1C40F20',
+     icon: AdsIcon,
+   },
+   conference: {
+     label: 'Conference',
+     color: '#E74C3C',
+     bgColor: '#E74C3C20',
+     icon: ConferenceIcon,
+   },
+   website: {
+     label: 'Website',
+     color: '#3498DB',
+     bgColor: '#3498DB20',
+     icon: WebIcon,
+   },
+   linkedin: {
+     label: 'LinkedIn',
+     color: '#0A66C2',
+     bgColor: '#0A66C220',
+     icon: LinkedInIcon,
+   },
+   manual: {
+     label: 'Manual',
+     color: '#95A5A6',
+     bgColor: '#95A5A620',
+     icon: ManualIcon,
+   },
+   api: {
+     label: 'API',
+     color: '#27AE60',
+     bgColor: '#27AE6020',
+     icon: ApiIcon,
+   },
+   import: {
+     label: 'Import',
+     color: '#8E44AD',
+     bgColor: '#8E44AD20',
+     icon: ImportIcon,
+   },
+ };
+ 
+ // Event type to icon mapping
+ const getEventIcon = (eventType) =&gt; {
+   const iconMap = {
+     // Website Events
+     page_visited: PageViewIcon,
+     form_submitted: FormIcon,
+     demo_requested: MeetingIcon,
+     pricing_viewed: PageViewIcon,
+     roi_calculator_submitted: FormIcon,
+     download_completed: DownloadIcon,
+     video_watched: VideoIcon,
+     // Email Events
+     email_sent: SendIcon,
+     email_opened: OpenedIcon,
+     email_clicked: ClickedIcon,
+     email_replied: ReplyIcon,
+     email_bounced: EmailIcon,
+     email_unsubscribed: EmailIcon,
+     // LinkedIn Events
+     linkedin_connection_sent: ConnectionIcon,
+     linkedin_connection_accepted: AcceptedIcon,
+     linkedin_message_sent: MessageIcon,
+     linkedin_message_replied: ReplyIcon,
+     linkedin_profile_viewed: PageViewIcon,
+     // Sales Events
+     meeting_scheduled: MeetingIcon,
+     meeting_completed: MeetingIcon,
+     call_completed: CallIcon,
+     proposal_sent: ProposalIcon,
+     contract_sent: ContractIcon,
+     deal_won: WonIcon,
+     deal_lost: LostIcon,
+     // Product Events
+     user_registered: RegisteredIcon,
+     order_placed: OrderIcon,
+     order_completed: OrderIcon,
+     subscription_started: SubscriptionIcon,
+     subscription_cancelled: SubscriptionIcon,
+     // Marketing Events
+     webinar_registered: ConferenceIcon,
+     webinar_attended: ConferenceIcon,
+     conference_visited: ConferenceIcon,
+     trade_show_scanned: ConferenceIcon,
+   };
+   return iconMap[eventType] || SourceIcon;
+ };
+ 
+ // Get human-readable event label
+ const getEventLabel = (eventType) =&gt; {
+   const labels = {
+     // Website Events
+     page_visited: 'Page Visited',
+     form_submitted: 'Form Submitted',
+     demo_requested: 'Demo Requested',
+     pricing_viewed: 'Pricing Viewed',
+     roi_calculator_submitted: 'ROI Calculator Submitted',
+     download_completed: 'Download Completed',
+     video_watched: 'Video Watched',
+     // Email Events
+     email_sent: 'Email Sent',
+     email_opened: 'Email Opened',
+     email_clicked: 'Email Clicked',
+     email_replied: 'Email Replied',
+     email_bounced: 'Email Bounced',
+     email_unsubscribed: 'Unsubscribed',
+     // LinkedIn Events
+     linkedin_connection_sent: 'Connection Request Sent',
+     linkedin_connection_accepted: 'Connection Accepted',
+     linkedin_message_sent: 'Message Sent',
+     linkedin_message_replied: 'Message Replied',
+     linkedin_profile_viewed: 'Profile Viewed',
+     // Sales Events
+     meeting_scheduled: 'Meeting Scheduled',
+     meeting_completed: 'Meeting Completed',
+     call_completed: 'Call Completed',
+     proposal_sent: 'Proposal Sent',
+     contract_sent: 'Contract Sent',
+     deal_won: 'Deal Won',
+     deal_lost: 'Deal Lost',
+     // Product Events
+     user_registered: 'User Registered',
+     order_placed: 'Order Placed',
+     order_completed: 'Order Completed',
+     subscription_started: 'Subscription Started',
+     subscription_cancelled: 'Subscription Cancelled',
+     // Marketing Events
+     webinar_registered: 'Webinar Registered',
+     webinar_attended: 'Webinar Attended',
+     conference_visited: 'Conference Visited',
+     trade_show_scanned: 'Trade Show Scanned',
+   };
+   // Format unknown event types: replace underscores and capitalize
+   return labels[eventType] || eventType.split('_').map(w =&gt; 
+     w.charAt(0).toUpperCase() + w.slice(1)
+   ).join(' ');
+ };
+ 
+ /**
+  * Parse and format date safely
+  */
+ const formatDate = (dateString) =&gt; {
+   if (!dateString) return 'Unknown';
+   try {
+     const date = typeof dateString === 'string' ? parseISO(dateString) : new Date(dateString);
+     if (!isValid(date)) return 'Unknown';
+     return format(date, 'dd.MM.yyyy HH:mm', { locale: de });
+   } catch {
+     return 'Unknown';
+   }
+ };
+ 
+ /**
+  * Format relative time
+  */
+ const formatRelativeTime = (dateString) =&gt; {
+   if (!dateString) return '';
+   try {
+     const date = typeof dateString === 'string' ? parseISO(dateString) : new Date(dateString);
+     if (!isValid(date)) return '';
+     return formatDistanceToNow(date, { addSuffix: true, locale: de });
+   } catch {
+     return '';
+   }
+ };
+ 
+ /**
+  * Metadata Display Component
+  */
+ const MetadataDisplay = ({ metadata }) =&gt; {
+   if (!metadata || Object.keys(metadata).length === 0) {
+     return (
+       &lt;Typography variant="body2" color="text.secondary" sx={{ fontStyle: 'italic' }}&gt;
+         No additional metadata
+       &lt;/Typography&gt;
+     );
+   }
+ 
+   return (
+     &lt;Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}&gt;
+       {Object.entries(metadata).map(([key, value]) =&gt; (
+         &lt;Box
+           key={key}
+           sx={{
+             display: 'flex',
+             alignItems: 'flex-start',
+             gap: 1,
+             p: 1,
+             bgcolor: 'background.default',
+             borderRadius: 1,
+           }}
+         &gt;
+           &lt;Typography
+             variant="caption"
+             sx={{
+               fontWeight: 600,
+               color: 'text.secondary',
+               minWidth: 100,
+               textTransform: 'capitalize',
+             }}
+           &gt;
+             {key.replace(/_/g, ' ')}:
+           &lt;/Typography&gt;
+           &lt;Typography
+             variant="caption"
+             sx={{
+               flex: 1,
+               wordBreak: 'break-word',
+               fontFamily: typeof value === 'object' ? 'monospace' : 'inherit',
+             }}
+           &gt;
+             {typeof value === 'object' ? JSON.stringify(value, null, 2) : String(value)}
+           &lt;/Typography&gt;
+         &lt;/Box&gt;
+       ))}
+     &lt;/Box&gt;
+   );
+ };
+ 
+ /**
+  * Single Timeline Entry
+  */
+ const TimelineEntry = ({ event, isLast }) =&gt; {
+   const [expanded, setExpanded] = useState(false);
+   
+   const source = SOURCE_CONFIG[event.source] || SOURCE_CONFIG.manual;
+   const EventIcon = getEventIcon(event.event_type);
+   const hasMetadata = event.metadata &amp;&amp; Object.keys(event.metadata).length &gt; 0;
+   const hasCampaign = event.campaign_id || event.utm_campaign || event.utm_source;
+ 
+   return (
+     &lt;Box sx={{ display: 'flex', position: 'relative' }}&gt;
+       {/* Timeline line */}
+       {!isLast &amp;&amp; (
+         &lt;Box
+           sx={{
+             position: 'absolute',
+             left: 19,
+             top: 40,
+             bottom: -16,
+             width: 2,
+             bgcolor: 'divider',
+             zIndex: 0,
+           }}
+         /&gt;
+       )}
+ 
+       {/* Timeline dot with icon */}
+       &lt;Tooltip title={source.label}&gt;
+         &lt;Box
+           sx={{
+             width: 40,
+             height: 40,
+             borderRadius: '50%',
+             bgcolor: source.bgColor,
+             border: &#96;2px solid ${source.color}&#96;,
+             display: 'flex',
+             alignItems: 'center',
+             justifyContent: 'center',
+             flexShrink: 0,
+             zIndex: 1,
+           }}
+         &gt;
+           &lt;EventIcon sx={{ fontSize: 18, color: source.color }} /&gt;
+         &lt;/Box&gt;
+       &lt;/Tooltip&gt;
+ 
+       {/* Content */}
+       &lt;Box sx={{ flex: 1, ml: 2, pb: 3 }}&gt;
+         &lt;Box
+           sx={{
+             p: 2,
+             bgcolor: 'background.paper',
+             borderRadius: 2,
+             border: '1px solid',
+             borderColor: expanded ? source.color : 'divider',
+             transition: 'all 0.2s ease',
+             '&amp;:hover': {
+               borderColor: source.color,
+               boxShadow: &#96;0 2px 8px ${source.color}20&#96;,
+             },
+           }}
+         &gt;
+           {/* Header */}
+           &lt;Box sx={{ display: 'flex', alignItems: 'flex-start', justifyContent: 'space-between', gap: 1, mb: 1 }}&gt;
+             &lt;Box sx={{ flex: 1 }}&gt;
+               &lt;Typography variant="subtitle2" sx={{ fontWeight: 600, lineHeight: 1.3 }}&gt;
+                 {getEventLabel(event.event_type)}
+               &lt;/Typography&gt;
+               {event.event_category &amp;&amp; (
+                 &lt;Typography variant="caption" color="text.secondary"&gt;
+                   {event.event_category}
+                 &lt;/Typography&gt;
+               )}
+             &lt;/Box&gt;
+             
+             {/* Score points badge (if present) */}
+             {event.score_points &gt; 0 &amp;&amp; (
+               &lt;Chip
+                 label={&#96;+${event.score_points}&#96;}
+                 size="small"
+                 sx={{
+                   bgcolor: '#28A74520',
+                   color: '#28A745',
+                   fontWeight: 700,
+                   fontSize: '0.75rem',
+                 }}
+               /&gt;
+             )}
+           &lt;/Box&gt;
+ 
+           {/* Source and Campaign Info */}
+           &lt;Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, mb: 1.5, flexWrap: 'wrap' }}&gt;
+             {/* Source chip */}
+             &lt;Chip
+               icon={&lt;source.icon sx={{ fontSize: 14 }} /&gt;}
+               label={source.label}
+               size="small"
+               sx={{
+                 bgcolor: source.bgColor,
+                 color: source.color,
+                 fontSize: '0.7rem',
+                 height: 22,
+                 '&amp; .MuiChip-icon': {
+                   color: 'inherit',
+                 },
+               }}
+             /&gt;
+ 
+             {/* Campaign info */}
+             {hasCampaign &amp;&amp; (
+               &lt;Chip
+                 label={event.utm_campaign || event.campaign_id || &#96;${event.utm_source}/${event.utm_medium}&#96;}
+                 size="small"
+                 variant="outlined"
+                 sx={{
+                   fontSize: '0.7rem',
+                   height: 22,
+                 }}
+               /&gt;
+             )}
+ 
+             {/* Time */}
+             &lt;Tooltip title={formatDate(event.occurred_at)}&gt;
+               &lt;Box sx={{ display: 'flex', alignItems: 'center', gap: 0.5 }}&gt;
+                 &lt;ScheduleIcon sx={{ fontSize: 14, color: 'text.secondary' }} /&gt;
+                 &lt;Typography variant="caption" color="text.secondary"&gt;
+                   {formatRelativeTime(event.occurred_at)}
+                 &lt;/Typography&gt;
+               &lt;/Box&gt;
+             &lt;/Tooltip&gt;
+           &lt;/Box&gt;
+ 
+           {/* Expand/Collapse Button for Metadata */}
+           {(hasMetadata || hasCampaign) &amp;&amp; (
+             &lt;Box sx={{ mt: 1 }}&gt;
+               &lt;IconButton
+                 onClick={() =&gt; setExpanded(!expanded)}
+                 size="small"
+                 sx={{
+                   p: 0.5,
+                   bgcolor: 'background.default',
+                   borderRadius: 1,
+                   '&amp;:hover': {
+                     bgcolor: source.bgColor,
+                   },
+                 }}
+               &gt;
+                 {expanded ? (
+                   &lt;ExpandLessIcon sx={{ fontSize: 16 }} /&gt;
+                 ) : (
+                   &lt;ExpandMoreIcon sx={{ fontSize: 16 }} /&gt;
+                 )}
+                 &lt;Typography variant="caption" sx={{ ml: 0.5, mr: 0.5 }}&gt;
+                   {expanded ? 'Hide Details' : 'Show Details'}
+                 &lt;/Typography&gt;
+               &lt;/IconButton&gt;
+ 
+               &lt;Collapse in={expanded}&gt;
+                 &lt;Box sx={{ mt: 2, pt: 2, borderTop: '1px dashed', borderColor: 'divider' }}&gt;
+                   {/* UTM Details */}
+                   {hasCampaign &amp;&amp; (
+                     &lt;Box sx={{ mb: 2 }}&gt;
+                       &lt;Typography variant="caption" sx={{ fontWeight: 600, color: 'text.secondary', mb: 1, display: 'block' }}&gt;
+                         Campaign Tracking
+                       &lt;/Typography&gt;
+                       &lt;Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1 }}&gt;
+                         {event.campaign_id &amp;&amp; (
+                           &lt;Chip label={&#96;Campaign: ${event.campaign_id}&#96;} size="small" variant="outlined" /&gt;
+                         )}
+                         {event.utm_source &amp;&amp; (
+                           &lt;Chip label={&#96;Source: ${event.utm_source}&#96;} size="small" variant="outlined" /&gt;
+                         )}
+                         {event.utm_medium &amp;&amp; (
+                           &lt;Chip label={&#96;Medium: ${event.utm_medium}&#96;} size="small" variant="outlined" /&gt;
+                         )}
+                         {event.utm_campaign &amp;&amp; (
+                           &lt;Chip label={&#96;UTM Campaign: ${event.utm_campaign}&#96;} size="small" variant="outlined" /&gt;
+                         )}
+                       &lt;/Box&gt;
+                     &lt;/Box&gt;
+                   )}
+ 
+                   {/* Metadata */}
+                   {hasMetadata &amp;&amp; (
+                     &lt;Box&gt;
+                       &lt;Typography variant="caption" sx={{ fontWeight: 600, color: 'text.secondary', mb: 1, display: 'block' }}&gt;
+                         Event Metadata
+                       &lt;/Typography&gt;
+                       &lt;MetadataDisplay metadata={event.metadata} /&gt;
+                     &lt;/Box&gt;
+                   )}
+                 &lt;/Box&gt;
+               &lt;/Collapse&gt;
+             &lt;/Box&gt;
+           )}
+         &lt;/Box&gt;
+       &lt;/Box&gt;
+     &lt;/Box&gt;
+   );
+ };
+ 
+ /**
+  * Source Filter Buttons
+  */
+ const SourceFilter = ({ selectedSource, onChange, availableSources }) =&gt; {
+   return (
+     &lt;Box sx={{ mb: 3 }}&gt;
+       &lt;Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1.5 }}&gt;
+         &lt;FilterIcon sx={{ fontSize: 18, color: 'text.secondary' }} /&gt;
+         &lt;Typography variant="body2" color="text.secondary"&gt;
+           Filter by Source
+         &lt;/Typography&gt;
+       &lt;/Box&gt;
+       &lt;ToggleButtonGroup
+         value={selectedSource}
+         exclusive
+         onChange={(_, value) =&gt; onChange(value)}
+         size="small"
+         sx={{
+           flexWrap: 'wrap',
+           gap: 1,
+           '&amp; .MuiToggleButton-root': {
+             border: '1px solid',
+             borderColor: 'divider',
+             borderRadius: '8px !important',
+             px: 2,
+             py: 0.75,
+             textTransform: 'none',
+             '&amp;.Mui-selected': {
+               borderColor: 'primary.main',
+             },
+           },
+         }}
+       &gt;
+         &lt;ToggleButton value={null}&gt;
+           &lt;Typography variant="body2" sx={{ fontWeight: 500 }}&gt;
+             All
+           &lt;/Typography&gt;
+         &lt;/ToggleButton&gt;
+         {availableSources.map((sourceKey) =&gt; {
+           const config = SOURCE_CONFIG[sourceKey];
+           if (!config) return null;
+           const Icon = config.icon;
+           return (
+             &lt;ToggleButton
+               key={sourceKey}
+               value={sourceKey}
+               sx={{
+                 '&amp;.Mui-selected': {
+                   bgcolor: config.bgColor,
+                   color: config.color,
+                   borderColor: &#96;${config.color} !important&#96;,
+                 },
+               }}
+             &gt;
+               &lt;Icon sx={{ fontSize: 16, mr: 0.75 }} /&gt;
+               &lt;Typography variant="body2" sx={{ fontWeight: 500 }}&gt;
+                 {config.label}
+               &lt;/Typography&gt;
+             &lt;/ToggleButton&gt;
+           );
+         })}
+       &lt;/ToggleButtonGroup&gt;
+     &lt;/Box&gt;
+   );
+ };
+ 
+ /**
+  * Summary Stats
+  */
+ const EventSummary = ({ events }) =&gt; {
+   if (!events || events.length === 0) return null;
+ 
+   const stats = events.reduce(
+     (acc, event) =&gt; {
+       acc.total += 1;
+       if (event.source) {
+         acc.bySource[event.source] = (acc.bySource[event.source] || 0) + 1;
+       }
+       acc.totalPoints += event.score_points || 0;
+       return acc;
+     },
+     { total: 0, bySource: {}, totalPoints: 0 }
+   );
+ 
+   return (
+     &lt;Box
+       sx={{
+         display: 'flex',
+         gap: 2,
+         mb: 3,
+         p: 2,
+         bgcolor: 'background.default',
+         borderRadius: 2,
+         flexWrap: 'wrap',
+       }}
+     &gt;
+       &lt;Box sx={{ minWidth: 80 }}&gt;
+         &lt;Typography variant="caption" color="text.secondary"&gt;
+           Total Events
+         &lt;/Typography&gt;
+         &lt;Typography variant="h5" sx={{ fontWeight: 700, color: 'primary.main' }}&gt;
+           {stats.total}
+         &lt;/Typography&gt;
+       &lt;/Box&gt;
+       &lt;Box sx={{ minWidth: 80 }}&gt;
+         &lt;Typography variant="caption" color="text.secondary"&gt;
+           Score Impact
+         &lt;/Typography&gt;
+         &lt;Typography variant="h6" sx={{ fontWeight: 600, color: stats.totalPoints &gt; 0 ? '#28A745' : 'text.secondary' }}&gt;
+           {stats.totalPoints &gt; 0 ? '+' : ''}{stats.totalPoints}
+         &lt;/Typography&gt;
+       &lt;/Box&gt;
+       {Object.entries(stats.bySource)
+         .sort((a, b) =&gt; b[1] - a[1])
+         .slice(0, 4)
+         .map(([sourceKey, count]) =&gt; {
+           const config = SOURCE_CONFIG[sourceKey];
+           if (!config) return null;
+           return (
+             &lt;Box key={sourceKey} sx={{ minWidth: 70 }}&gt;
+               &lt;Typography variant="caption" color="text.secondary"&gt;
+                 {config.label}
+               &lt;/Typography&gt;
+               &lt;Typography variant="h6" sx={{ fontWeight: 600, color: config.color }}&gt;
+                 {count}
+               &lt;/Typography&gt;
+             &lt;/Box&gt;
+           );
+         })}
+     &lt;/Box&gt;
+   );
+ };
+ 
+ /**
+  * Main Event Timeline Component
+  */
+ const EventTimeline = ({ leadId, limit = 50 }) =&gt; {
+   const [events, setEvents] = useState([]);
+   const [loading, setLoading] = useState(true);
+   const [error, setError] = useState(null);
+   const [selectedSource, setSelectedSource] = useState(null);
+ 
+   useEffect(() =&gt; {
+     const fetchEvents = async () =&gt; {
+       if (!leadId) {
+         setLoading(false);
+         return;
+       }
+ 
+       setLoading(true);
+       setError(null);
+ 
+       try {
+         const data = await getLeadEvents(leadId, { limit });
+         setEvents(Array.isArray(data) ? data : []);
+       } catch (err) {
+         console.error('Failed to fetch events:', err);
+         setError(err.message || 'Failed to load events');
+       } finally {
+         setLoading(false);
+       }
+     };
+ 
+     fetchEvents();
+   }, [leadId, limit]);
+ 
+   // Get available sources from events
+   const availableSources = [...new Set(events.map((e) =&gt; e.source))].filter(Boolean);
+ 
+   // Filter events by source
+   const filteredEvents = selectedSource
+     ? events.filter((event) =&gt; event.source === selectedSource)
+     : events;
+ 
+   // Loading state
+   if (loading) {
+     return (
+       &lt;Card&gt;
+         &lt;CardContent&gt;
+           &lt;Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center', py: 4 }}&gt;
+             &lt;CircularProgress size={32} /&gt;
+             &lt;Typography sx={{ ml: 2 }} color="text.secondary"&gt;
+               Loading events...
+             &lt;/Typography&gt;
+           &lt;/Box&gt;
+         &lt;/CardContent&gt;
+       &lt;/Card&gt;
+     );
+   }
+ 
+   // Error state
+   if (error) {
+     return (
+       &lt;Card&gt;
+         &lt;CardContent&gt;
+           &lt;Alert severity="error" sx={{ mb: 0 }}&gt;
+             {error}
+           &lt;/Alert&gt;
+         &lt;/CardContent&gt;
+       &lt;/Card&gt;
+     );
+   }
+ 
+   return (
+     &lt;Card&gt;
+       &lt;CardContent&gt;
+         &lt;Typography variant="h6" sx={{ mb: 2, fontWeight: 600 }}&gt;
+           Marketing Events
+         &lt;/Typography&gt;
+ 
+         {/* Summary */}
+         &lt;EventSummary events={events} /&gt;
+ 
+         {/* Source Filter */}
+         {availableSources.length &gt; 1 &amp;&amp; (
+           &lt;SourceFilter
+             selectedSource={selectedSource}
+             onChange={setSelectedSource}
+             availableSources={availableSources}
+           /&gt;
+         )}
+ 
+         {/* Timeline */}
+         {filteredEvents.length === 0 ? (
+           &lt;Box
+             sx={{
+               py: 4,
+               textAlign: 'center',
+               bgcolor: 'background.default',
+               borderRadius: 2,
+             }}
+           &gt;
+             &lt;Typography color="text.secondary"&gt;
+               {selectedSource
+                 ? &#96;No events from ${SOURCE_CONFIG[selectedSource]?.label || selectedSource} found&#96;
+                 : 'No events recorded yet'}
+             &lt;/Typography&gt;
+           &lt;/Box&gt;
+         ) : (
+           &lt;Box sx={{ mt: 2 }}&gt;
+             {filteredEvents.map((event, index) =&gt; (
+               &lt;TimelineEntry
+                 key={event.id || index}
+                 event={event}
+                 isLast={index === filteredEvents.length - 1}
+               /&gt;
+             ))}
+           &lt;/Box&gt;
+         )}
+ 
+         {/* Load more hint */}
+         {filteredEvents.length &gt;= limit &amp;&amp; (
+           &lt;Box sx={{ textAlign: 'center', mt: 2 }}&gt;
+             &lt;Typography variant="caption" color="text.secondary"&gt;
+               Showing last {limit} events
+             &lt;/Typography&gt;
+           &lt;/Box&gt;
+         )}
+       &lt;/CardContent&gt;
+     &lt;/Card&gt;
+   );
+ };
+ 
+ export default EventTimeline;
+ export { EventTimeline, SOURCE_CONFIG, getEventLabel, getEventIcon };
+ 
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt muss ich:
1. Die index.js aktualisieren, um EventTimeline zu exportieren
2. LeadShow.jsx erweitern, um einen dritten Tab für Events hinzuzufügen
3. Linter-Fehler überprüfen</details></think>

---

Jetzt aktualisiere ich die index.js und LeadShow.jsx:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: e:\dname\crm_dna-me\frontend\src\resources\leads\components\index.js</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -4,3 +4,4 @@
   */
  export { ScoreHistory, CATEGORY_CONFIG } from './ScoreHistory';
+ export { EventTimeline, SOURCE_CONFIG, getEventLabel, getEventIcon } from './EventTimeline';
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt muss ich LeadShow.jsx erweitern, um den Events-Tab hinzuzufügen:
1. Import der EventTimeline-Komponente aktualisieren
2. Einen dritten Tab hinzufügen</details></think>

---

Jetzt erweitere ich LeadShow.jsx um den Events-Tab:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: e:\dname\crm_dna-me\frontend\src\resources\leads\LeadShow.jsx</summary>

**Chunk 1**
Lines added: 2, lines removed: 1

```diff
@@ -34,7 +34,8 @@
    Timeline as TimelineIcon,
    Refresh as RefreshIcon,
+   Event as EventIcon,
  } from '@mui/icons-material';
  import { ScoreBadge, StatusBadge } from '../../components/common';
- import { ScoreHistory } from './components';
+ import { ScoreHistory, EventTimeline } from './components';
  import { recalculateLeadScores } from '../../providers/dataProvider';
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt muss ich den Tabs-Bereich in LeadShow.jsx aktualisieren, um einen dritten Tab für Events hinzuzufügen.</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: e:\dname\crm_dna-me\frontend\src\resources\leads\LeadShow.jsx</summary>

**Chunk 1**
Lines added: 7, lines removed: undefined

```diff
@@ -414,4 +414,11 @@
                    aria-controls="lead-tabpanel-1" 
                  /&gt;
+                 &lt;Tab 
+                   icon={&lt;EventIcon sx={{ fontSize: 18 }} /&gt;}
+                   iconPosition="start"
+                   label="Events" 
+                   id="lead-tab-2" 
+                   aria-controls="lead-tabpanel-2" 
+                 /&gt;
                &lt;/Tabs&gt;
              &lt;/Box&gt;
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt muss ich den TabPanel für Events hinzufügen.</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: e:\dname\crm_dna-me\frontend\src\resources\leads\LeadShow.jsx</summary>

**Chunk 1**
Lines added: 5, lines removed: undefined

```diff
@@ -440,4 +440,9 @@
                  &lt;ScoreHistory key={refreshKey} leadId={record.id} limit={50} /&gt;
                &lt;/TabPanel&gt;
+               
+               {/* Events Tab */}
+               &lt;TabPanel value={tabValue} index={2}&gt;
+                 &lt;EventTimeline leadId={record.id} limit={50} /&gt;
+               &lt;/TabPanel&gt;
              &lt;/CardContent&gt;
            &lt;/Card&gt;
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt sollte ich die Linter-Fehler überprüfen und die TODO als abgeschlossen markieren.</details></think>

---

Jetzt überprüfe ich die Linter-Fehler:

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 3 files</summary>
      
Lint paths:

- `e:\dname\crm_dna-me\frontend\src\resources\leads\components\EventTimeline.jsx`
- `e:\dname\crm_dna-me\frontend\src\resources\leads\components\index.js`
- `e:\dname\crm_dna-me\frontend\src\resources\leads\LeadShow.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Die Linter-Fehler sind alle behoben. Jetzt markiere ich die Aufgabe als abgeschlossen.</details></think>

---

Ausgezeichnet! Keine Linter-Fehler. Ich markiere die Aufgabe als abgeschlossen:

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] EventTimeline Komponente erstellen mit Event-Icons und expandierbarer Metadata

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ich habe die EventTimeline-Komponente erfolgreich implementiert. Hier ist eine Zusammenfassung dessen, was ich erstellt habe:

1. **EventTimeline.jsx** - Eine neue Komponente mit:
   - Chronologischer Event-Liste als Timeline
   - Event-spezifische Icons für verschiedene Event-Typen (page_visited, email_opened, etc.)
   - Source-Konfiguration mit individuellen Farben und Icons für alle unterstützten Quellen (waalaxy, portal, lemlist, ads, conference, website, linkedin, manual, api, import)
   - Expandierbare Metadata-Anzeige mit Collapse-Funktionalität
   - Campaign-Tracking-Informationen (UTM-Parameter, Campaign-ID)
   - Filter nach Source
   - Zusammenfassungs-Statistiken (Total Events, Score Impact, Events pro Source)
   - Relative Zeitanzeige auf Deutsch
   
2. **index.js** - Export für EventTimeline und zugehörige Utilities aktualisiert

3. **LeadShow.jsx** - Neuer "Events"-Tab hinzugefügt mit EventTimeline-Integration

Der DataProvider hatte bereits `getLeadEvents` implementiert, sodass keine Änderungen dort nötig waren.

Die Komponente folgt dem gleichen Design-Stil wie ScoreHistory mit:
- Material-UI Components
- Timeline-Darstellung mit verbindenden Linien
- Hover-Effekte
- Deutsche Lokalisierung für Datums-Formatierung
- Responsive Design</details></think>

---

Ich habe die **EventTimeline-Komponente** erfolgreich implementiert. Hier ist eine Zusammenfassung der Änderungen:

## Erstellte Dateien

### `EventTimeline.jsx`
Neue Komponente mit folgenden Features:

- **Chronologische Event-Timeline** mit verbindenden Linien
- **Event-Icons** für jeden Event-Typ (z.B. `PageViewIcon` für `page_visited`, `EmailIcon` für E-Mail-Events, `MeetingIcon` für Meetings)
- **Source-Konfiguration** mit individuellen Farben für alle 10 unterstützten Quellen:
  - Waalaxy, Portal, Lemlist, Ads, Conference, Website, LinkedIn, Manual, API, Import
- **Expandierbare Metadata** - Klickbare Details für jedes Event mit:
  - Campaign-Tracking (UTM-Parameter, Campaign-ID)
  - Event-Metadata als strukturierte Key-Value-Paare
- **Source-Filter** - Filterung nach Datenquelle
- **Statistik-Zusammenfassung** - Total Events, Score Impact, Events pro Source
- **Deutsche Lokalisierung** für Zeitanzeigen

## Geänderte Dateien

### `components/index.js`
```javascript
export { EventTimeline, SOURCE_CONFIG, getEventLabel, getEventIcon } from './EventTimeline';
```

### `LeadShow.jsx`
- Import von `EventTimeline` und `EventIcon` hinzugefügt
- Neuer **"Events"**-Tab mit Icon als dritter Tab
- TabPanel mit `EventTimeline`-Integration

Die Komponente nutzt den bereits vorhandenen `getLeadEvents` API-Aufruf im DataProvider und folgt dem gleichen Design-Stil wie die ScoreHistory-Komponente.

---

