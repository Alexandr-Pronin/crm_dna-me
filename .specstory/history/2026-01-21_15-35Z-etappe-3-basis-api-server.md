<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session ba0d54e3-f660-4777-b43c-fcb94e7a0a1a (2026-01-21 15:35Z) -->

# Etappe 3 Basis API server (2026-01-21 15:35Z)

_**User (2026-01-21 14:32Z)**_

Implement the following to-dos from the plan (the plan is attached for your reference). Do NOT edit the plan file itself.

You have been assigned the following 1 to-do(s) with IDs: etappe-3

1. [etappe-3] Etappe 3: Basis API Server - Types, Redis, Fastify Server

These to-dos have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the assigned to-dos.

---

_**Agent (model claude-4.5-opus-high-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
Der Benutzer m√∂chte, dass ich Etappe 3 aus dem Plan implementiere: Basis API Server - Types, Redis, Fastify Server.

Laut dem Plan umfasst Etappe 3:
1. 3.1 - TypeScript Types erstellen (src/types/index.ts)
2. 3.2 - Redis Connection erstellen (src/config/redis.ts)
3. 3.3 - Global Error Handler erstellen (src/api/middleware/errorHandler.ts)
4. 3.4 - Fastify Server erstellen (src/index.ts)
5. 3.5 - Server testen

Ich sollte zuerst die Todo als "in_progress" markieren und dann mit der Implementierung beginnen. Lass mich zuerst die existierenden Dateien √ºberpr√ºfen, um den aktuellen Stand zu verstehen.</details></think>

---

Ich werde Etappe 3 implementieren: Basis API Server mit Types, Redis Connection und Fastify Server. Lass mich zuerst den aktuellen Stand des Projekts √ºberpr√ºfen.

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [-] Etappe 3: Basis API Server - Types, Redis, Fastify Server

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\docs\DNA_ME_CRM_CURSOR_MASTER_PROMPT_PART1.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt habe ich ein gutes Verst√§ndnis des Projekts. Lass mich die existierenden Dateien √ºberpr√ºfen, um zu sehen, was bereits implementiert ist:

1. src/types/index.ts - Schon erstellt, muss ich √ºberpr√ºfen
2. src/config/redis.ts - Schon erstellt, muss ich √ºberpr√ºfen
3. src/errors/index.ts - Schon erstellt, muss ich √ºberpr√ºfen
4. src/config/index.ts - Schon erstellt, muss ich √ºberpr√ºfen
5. src/index.ts - Schon erstellt, muss ich √ºberpr√ºfen

Lass mich diese Dateien lesen, um zu sehen, was bereits existiert und was ich vervollst√§ndigen oder korrigieren muss.</details></think>

---

Gut, ich sehe, dass bereits einige Dateien existieren. Lass mich den aktuellen Stand der existierenden Dateien √ºberpr√ºfen, um zu sehen, was noch vervollst√§ndigt werden muss.

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\src\types\index.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\src\config\redis.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\src\errors\index.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\src\config\index.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\src\index.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\src\db\index.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Hervorragend! Die meisten Dateien f√ºr Etappe 3 existieren bereits und sehen sehr vollst√§ndig aus:

1. ‚úÖ `src/types/index.ts` - Vollst√§ndig mit allen Types
2. ‚úÖ `src/config/redis.ts` - Vollst√§ndig mit Redis Connection
3. ‚úÖ `src/errors/index.ts` - Vollst√§ndig mit Error Classes
4. ‚úÖ `src/config/index.ts` - Vollst√§ndig mit Konfiguration
5. ‚úÖ `src/db/index.ts` - Vollst√§ndig mit DB Connection
6. ‚úÖ `src/index.ts` - Fastify Server ist implementiert

Allerdings fehlt laut Plan noch:
- 3.3: Global Error Handler (`src/api/middleware/errorHandler.ts`)

Lass mich das √ºberpr√ºfen und auch die queues.ts und workers/index.ts √ºberpr√ºfen.</details></think>

---

Sehr gut! Die meisten Dateien existieren bereits. Lass mich √ºberpr√ºfen, was noch fehlt - der Error Handler Middleware und die queues.ts:

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\src\config\queues.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\src\workers\index.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\package.json</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt sehe ich, was noch fehlt:

1. ‚úÖ `src/types/index.ts` - Vollst√§ndig
2. ‚úÖ `src/config/redis.ts` - Vollst√§ndig
3. ‚ùå `src/api/middleware/errorHandler.ts` - Fehlt komplett
4. ‚úÖ `src/index.ts` - Existiert, aber der Error Handler wird noch nicht verwendet
5. ‚úÖ `src/config/queues.ts` - Vollst√§ndig
6. ‚úÖ `src/workers/index.ts` - Basis vorhanden

Was ich jetzt tun muss:
1. Erstelle `src/api/middleware/errorHandler.ts`
2. Registriere den Error Handler in `src/index.ts`

Lass mich auch √ºberpr√ºfen, ob es eine .env Datei gibt und ob Docker l√§uft.</details></think>

---

Ich sehe, dass die meisten Dateien bereits existieren und gut implementiert sind. Es fehlt nur noch:

1. **Error Handler Middleware** (`src/api/middleware/errorHandler.ts`) - fehlt komplett
2. **Error Handler in Fastify registrieren** - noch nicht in `src/index.ts` eingebunden

Lass mich diese erstellen und den Server vervollst√§ndigen:

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** ‚Ä¢ Edit file: E:\dname\crm_dna-me\src\api\middleware\errorHandler.ts</summary>

**Chunk 1**
Lines added: 136, lines removed: 1

```diff
@@ -1,1 +1,136 @@
- 
+ // =============================================================================
+ // src/api/middleware/errorHandler.ts
+ // Global Error Handler for Fastify
+ // =============================================================================
+ 
+ import type { FastifyError, FastifyReply, FastifyRequest } from 'fastify';
+ import { ZodError } from 'zod';
+ import { AppError, isAppError } from '../../errors/index.js';
+ 
+ // =============================================================================
+ // Error Response Interface
+ // =============================================================================
+ 
+ interface ErrorResponse {
+   error: {
+     code: string;
+     message: string;
+     details?: Record&lt;string, unknown&gt;;
+     requestId?: string;
+   };
+ }
+ 
+ // =============================================================================
+ // Format Zod Errors
+ // =============================================================================
+ 
+ function formatZodError(error: ZodError): { message: string; details: Record&lt;string, unknown&gt; } {
+   const errors = error.errors.map((err) =&gt; ({
+     path: err.path.join('.'),
+     message: err.message
+   }));
+ 
+   return {
+     message: 'Validation failed',
+     details: { validationErrors: errors }
+   };
+ }
+ 
+ // =============================================================================
+ // Error Handler
+ // =============================================================================
+ 
+ export function errorHandler(
+   error: FastifyError | AppError | ZodError | Error,
+   request: FastifyRequest,
+   reply: FastifyReply
+ ): void {
+   // Log the error
+   request.log.error({
+     err: error,
+     requestId: request.id,
+     url: request.url,
+     method: request.method
+   }, 'Request error');
+ 
+   // Default error response
+   let statusCode = 500;
+   let response: ErrorResponse = {
+     error: {
+       code: 'INTERNAL_ERROR',
+       message: 'An unexpected error occurred',
+       requestId: request.id
+     }
+   };
+ 
+   // Handle AppError (our custom errors)
+   if (isAppError(error)) {
+     statusCode = error.statusCode;
+     response = {
+       error: {
+         code: error.code,
+         message: error.message,
+         details: error.details,
+         requestId: request.id
+       }
+     };
+   }
+   // Handle Zod validation errors
+   else if (error instanceof ZodError) {
+     statusCode = 400;
+     const formatted = formatZodError(error);
+     response = {
+       error: {
+         code: 'VALIDATION_ERROR',
+         message: formatted.message,
+         details: formatted.details,
+         requestId: request.id
+       }
+     };
+   }
+   // Handle Fastify errors (e.g., validation, rate limit)
+   else if ('statusCode' in error &amp;&amp; typeof error.statusCode === 'number') {
+     statusCode = error.statusCode;
+     response = {
+       error: {
+         code: (error as FastifyError).code || 'FASTIFY_ERROR',
+         message: error.message,
+         requestId: request.id
+       }
+     };
+   }
+ 
+   // Remove details in production for 5xx errors
+   if (process.env.NODE_ENV === 'production' &amp;&amp; statusCode &gt;= 500) {
+     response.error.message = 'An unexpected error occurred';
+     delete response.error.details;
+   }
+ 
+   reply.status(statusCode).send(response);
+ }
+ 
+ // =============================================================================
+ // Not Found Handler
+ // =============================================================================
+ 
+ export function notFoundHandler(
+   request: FastifyRequest,
+   reply: FastifyReply
+ ): void {
+   request.log.warn({
+     requestId: request.id,
+     url: request.url,
+     method: request.method
+   }, 'Route not found');
+ 
+   reply.status(404).send({
+     error: {
+       code: 'NOT_FOUND',
+       message: &#96;Route ${request.method} ${request.url} not found&#96;,
+       requestId: request.id
+     }
+   });
+ }
+ 
+ export default errorHandler;
+ 
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Gut, jetzt muss ich den Error Handler in der Fastify-Anwendung registrieren. Lass mich src/index.ts aktualisieren.</details></think>

---

Jetzt muss ich den Error Handler in der Fastify-Anwendung registrieren:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: E:\dname\crm_dna-me\src\index.ts</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -10,4 +10,5 @@
  import { getRedisConnection, closeRedisConnection } from './config/redis.js';
  import { initializeQueues, closeQueues } from './config/queues.js';
+ import { errorHandler, notFoundHandler } from './api/middleware/errorHandler.js';
  import type { HealthCheckResponse } from './types/index.js';
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt muss ich den Error Handler und den Not Found Handler in Fastify registrieren.</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: E:\dname\crm_dna-me\src\index.ts</summary>

**Chunk 1**
Lines added: 7, lines removed: undefined

```diff
@@ -43,4 +43,11 @@
    credentials: true
  });
+ 
+ // =============================================================================
+ // Error Handling
+ // =============================================================================
+ 
+ fastify.setErrorHandler(errorHandler);
+ fastify.setNotFoundHandler(notFoundHandler);
  
  // =============================================================================
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt pr√ºfe ich auf Lint-Fehler und √ºberpr√ºfe, ob alles korrekt ist.</details></think>

---

Lass mich auf Lint-Fehler pr√ºfen:

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** ‚Ä¢ Read lints for 2 files</summary>
      
Lint paths:

- `E:\dname\crm_dna-me\src\api\middleware\errorHandler.ts`
- `E:\dname\crm_dna-me\src\index.ts`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Keine Lint-Fehler. Jetzt lass mich √ºberpr√ºfen, ob die .env Datei existiert und ob ich den Server testen kann.</details></think>

---

Gut, keine Fehler. Jetzt √ºberpr√ºfe ich die .env Datei und starte den Server zum Testen:

---

Model tried to read E:\dname\crm_dna-me\.env, but was prevented due to globalignore

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Es l√§uft bereits `docker-compose up -d` und `npm run dev` in Terminals. Ich sehe, dass der Server bereits gestartet ist. Lass mich den aktuellen Status in den Terminals √ºberpr√ºfen.</details></think>

---

Es scheint, dass Docker und der Dev-Server bereits laufen. Lass mich die Terminal-Ausgabe √ºberpr√ºfen:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: c:\Users\–ê–ª–µ–∫—Å–∞–Ω–¥—Ä\.cursor\projects\e-dname-crm-dna-me\terminals\2.txt</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: c:\Users\–ê–ª–µ–∫—Å–∞–Ω–¥—Ä\.cursor\projects\e-dname-crm-dna-me\terminals\1.txt</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Der Server l√§uft bereits und zeigt die Startmeldung. Docker ist noch beim Herunterladen von Images, aber der Server hat sich bereits verbunden (da scheinbar die Container schon laufen). 

Lass mich den Health Endpoint testen, um sicherzustellen, dass alles funktioniert.</details></think>

---

Ausgezeichnet! Der Server l√§uft bereits. Lass mich die Endpoints testen:

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** ‚Ä¢ Run command: cd E:\dname\crm_dna-me && Invoke-RestMethod http://localhost:3000/health | ConvertTo-Json</summary>

```bash
cd E:\dname\crm_dna-me && Invoke-RestMethod http://localhost:3000/health | ConvertTo-Json
```

```
In C:\Users\ÔøΩÔøΩÔøΩÔøΩ·†≠ÔøΩÔøΩ\AppData\Local\Temp\ps-script-5f3798ff-54fa-4ae0-84dd-aae56e297c77.ps1:7 Zeichen:24
+ cd E:\dname\crm_dna-me &amp;&amp; Invoke-RestMethod http://localhost:3000/hea ...
+                        ~~
Das Token "&amp;&amp;" ist in dieser Version kein gultiges Anweisungstrennzeichen.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : InvalidEndOfLine
 

```
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
PowerShell verwendet andere Syntax. Lass mich es mit einem Semikolon oder einfach ohne cd versuchen.</details></think>

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** ‚Ä¢ Run command: Invoke-RestMethod http://localhost:3000/health | ConvertTo-Json</summary>

```bash
Invoke-RestMethod http://localhost:3000/health | ConvertTo-Json
```
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Lass mich die Ausgabe lesen.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: c:\Users\–ê–ª–µ–∫—Å–∞–Ω–¥—Ä\.cursor\projects\e-dname-crm-dna-me\agent-tools\b05e6ec0-8d1a-4391-96b9-0ea25b8f0fdb.txt</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Der wichtige Teil ist in den ersten 10 Zeilen - der Health Check funktioniert perfekt:

```json
{
    "status":  "healthy",
    "timestamp":  "2026-01-21T15:37:11.689Z",
    "version":  "1.0.0",
    "services":  {
                     "database":  true,
                     "redis":  true
                 }
}
```

Die anderen Fehler sind PowerShell-Encoding-Probleme, die nicht mit unserer Anwendung zusammenh√§ngen.Lass mich noch die anderen Endpoints testen.</details></think>

---

Der Health-Check funktioniert perfekt! Der Server ist gesund:

```json
{
    "status": "healthy",
    "timestamp": "2026-01-21T15:37:11.689Z",
    "version": "1.0.0",
    "services": {
        "database": true,
        "redis": true
    }
}
```

Lass mich noch weitere Endpoints testen:

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** ‚Ä¢ Run command: Invoke-RestMethod http://localhost:3000/ready | ConvertTo-Json</summary>

```bash
Invoke-RestMethod http://localhost:3000/ready | ConvertTo-Json
```
</details>
</tool-use>

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** ‚Ä¢ Run command: Invoke-RestMethod http://localhost:3000/ | ConvertTo-Json</summary>

```bash
Invoke-RestMethod http://localhost:3000/ | ConvertTo-Json
```
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Lass mich die Ausgabe dieser Befehle lesen.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: c:\Users\–ê–ª–µ–∫—Å–∞–Ω–¥—Ä\.cursor\projects\e-dname-crm-dna-me\agent-tools\b172ea76-d497-4d0b-9589-4ad34832379d.txt</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: c:\Users\–ê–ª–µ–∫—Å–∞–Ω–¥—Ä\.cursor\projects\e-dname-crm-dna-me\agent-tools\4beec678-fb24-4656-8bdf-13b7b1ed65ad.txt</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Alle Endpoints funktionieren:1. `/ready` ‚Üí `{ "ready": true }`
2. `/` ‚Üí `{ "name": "DNA Marketing Engine", "version": "1.0.0", "status": "running", ... }`
3. `/health` ‚Üí `{ "status": "healthy", "services": { "database": true, "redis": true } }`
Jetzt sollte ich auch testen, ob der Error Handler funktioniert, indem ich eine nicht existierende Route aufrufe.</details></think>

---

Ausgezeichnet! Alle Endpoints funktionieren perfekt:

- **`/ready`** ‚Üí `{ "ready": true }`
- **`/`** ‚Üí `{ "name": "DNA Marketing Engine", "version": "1.0.0", "status": "running", ... }`
- **`/health`** ‚Üí `{ "status": "healthy", "services": { "database": true, "redis": true } }`

Lass mich noch den Error Handler testen, indem ich eine nicht existierende Route aufrufe:

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** ‚Ä¢ Run command: try { Invoke-RestMethod http://localhost:3000/nonexistent } catch { $_.ErrorDetails.Message }</summary>

```bash
try { Invoke-RestMethod http://localhost:3000/nonexistent } catch { $_.ErrorDetails.Message }
```
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Lass mich die Ausgabe lesen.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: c:\Users\–ê–ª–µ–∫—Å–∞–Ω–¥—Ä\.cursor\projects\e-dname-crm-dna-me\agent-tools\ea10bf2d-2975-4d17-9923-d2575b0c2b82.txt</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Der Not Found Handler funktioniert einwandfrei:```json
{"error":{"code":"NOT_FOUND","message":"Route GET /nonexistent not found","requestId":"req-4"}}
```Etappe 3 ist nun vollst√§ndig implementiert. Lass mich die Todo-Liste aktualisieren.</details></think>

---

Der Error Handler funktioniert perfekt:

```json
{"error":{"code":"NOT_FOUND","message":"Route GET /nonexistent not found","requestId":"req-4"}}
```

Etappe 3 ist vollst√§ndig implementiert. Lass mich die finalen Dateien zusammenfassen und die Todo aktualisieren:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: E:\dname\crm_dna-me\src\index.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Alles ist vollst√§ndig implementiert. Lass mich die Todo als completed markieren.</details></think>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [x] Etappe 3: Basis API Server - Types, Redis, Fastify Server

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Perfekt! Etappe 3 ist abgeschlossen. Lass mich eine Zusammenfassung schreiben.</details></think>

---

## ‚úÖ Etappe 3 abgeschlossen!

**Basis API Server - Types, Redis, Fastify Server** wurde erfolgreich implementiert.

### Was wurde vervollst√§ndigt:

#### 1. **TypeScript Types** (`src/types/index.ts`)
Bereits vorhanden mit allen Types:
- Enums: `LeadStatus`, `LifecycleStage`, `RoutingStatus`, `IntentType`, `DealStatus`, etc.
- Interfaces: `Organization`, `Lead`, `Pipeline`, `PipelineStage`, `Deal`, `MarketingEvent`, `IntentSignal`, `ScoringRule`, etc.
- Job Types: `EventProcessingJob`, `RoutingJob`, `SyncJob`
- API Types: `PaginatedResponse<T>`, `HealthCheckResponse`

#### 2. **Redis Connection** (`src/config/redis.ts`)
Bereits vorhanden mit:
- Parsed Redis URL
- BullMQ-kompatible Optionen
- Event Handler (connect, error, close)
- `testRedisConnection()` und `closeRedisConnection()` Funktionen

#### 3. **Global Error Handler** (`src/api/middleware/errorHandler.ts`) ‚ú® NEU
- `errorHandler()` - Behandelt `AppError`, `ZodError`, Fastify Errors
- `notFoundHandler()` - Gibt strukturierte 404 Responses
- Request-ID in allen Fehlermeldungen
- Sichere Fehlerausgabe in Production

#### 4. **Fastify Server** (`src/index.ts`)
Bereits vorhanden, jetzt mit Error Handler erweitert:
- CORS Plugin registriert
- **Error Handler registriert** ‚ú®
- **Not Found Handler registriert** ‚ú®
- Health Check (`/health`)
- Ready Check (`/ready`)
- Graceful Shutdown f√ºr SIGTERM/SIGINT

### Getestete Endpoints:

| Endpoint | Response |
|----------|----------|
| `GET /` | `{ "name": "DNA Marketing Engine", "status": "running" }` |
| `GET /health` | `{ "status": "healthy", "services": { "database": true, "redis": true } }` |
| `GET /ready` | `{ "ready": true }` |
| `GET /nonexistent` | `{ "error": { "code": "NOT_FOUND", "message": "Route GET /nonexistent not found" } }` |

### Server l√§uft:
```
üß¨ DNA Marketing Engine v1.0.0
Server running at http://0.0.0.0:3000
Environment: development
```

---

