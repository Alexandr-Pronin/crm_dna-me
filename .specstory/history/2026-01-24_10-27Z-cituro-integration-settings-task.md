<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 57aa3f83-641d-4f4d-b280-ce22cdc5eb1c (2026-01-24 10:27Z) -->

# Cituro integration settings task (2026-01-24 10:27Z)

_**User (2026-01-24 09:54Z)**_

Implement the following to-dos from the plan (the plan is attached for your reference). Do NOT edit the plan file itself.

You have been assigned the following 1 to-do(s) with IDs: settings-cituro

1. [settings-cituro] Cituro in IntegrationSettings hinzufugen

These to-dos have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the assigned to-dos.

---

_**Agent (model composer-1, mode Agent)**_



---


Prüfe die aktuelle Struktur von IntegrationSettings, um Cituro hinzuzufügen.


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] Cituro in IntegrationSettings hinzufugen

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/pages/Settings/IntegrationSettings.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How are integrations configured and tested in the backend API?" • **14** results</summary>
            
| File | Lines |
|------|-------|
| `src/config/index.ts` | L6-83 |
| `src/config/index.ts` | L87-169 |
| `docs/DNA_ME_CRM_CURSOR_STEP_BY_STEP_GUIDE.md` | L1495-1560 |
| `README.md` | L77-137 |
| `README.md` | L131-190 |
| `docs/DNA_ME_CRM_CURSOR_STEP_BY_STEP_GUIDE.md` | L1289-1396 |
| `docs/DNA_ME_CRM_CURSOR_STEP_BY_STEP_GUIDE.md` | L1124-1174 |
| `src/api/routes/events.ts` | L23-355 |
| `env.example` | L43 |
| `src/api/routes/scoring.ts` | L45 |
| `docs/DNA_ME_CRM_CURSOR_STEP_BY_STEP_GUIDE.md` | L770-850 |
| `docs/DNA_ME_CRM_CURSOR_STEP_BY_STEP_GUIDE.md` | L1391-1440 |
| `docs/DNA_ME_CRM_CURSOR_STEP_BY_STEP_GUIDE.md` | L949-999 |
| `src/config/routingConfig.ts` | L18-91 |

</details>
</tool-use>

---



---


Prüfe die Backend-API und den dataProvider, um zu sehen, wie Integrationen abgerufen werden:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/providers/dataProvider.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where is the integrations status API endpoint that returns moco and slack status?" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `README.md` | L77-137 |
| `src/config/index.ts` | L6-83 |
| `docs/DNA_ME_CRM_CURSOR_STEP_BY_STEP_GUIDE.md` | L1495-1560 |
| `src/index.ts` | L53-96 |
| `src/index.ts` | L73-122 |
| `src/config/index.ts` | L87-169 |
| `src/index.ts` | L73-96 |
| `src/api/routes/routing.ts` | L27-286 |
| `src/api/routes/leads.ts` | L99-808 |
| `README.md` | L131-190 |
| `env.example` | L43 |
| `src/index.ts` | L120-187 |
| `src/api/routes/routing.ts` | L33-286 |
| `src/integrations/.gitkeep` | L1 |
| `src/api/routes/scoring.ts` | L49-470 |

</details>
</tool-use>

---



---


Prüfe die Backend-Integrations-Route, um zu sehen, wie der Status abgerufen wird:


---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** • Searched codebase "**/integrations.ts" • **1** result in **1** directory</summary>

Directory: **e:\dname\crm_dna-me** (1 file)

| File |
|------|
| `src\api\routes\integrations.ts` |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where is the integrations status endpoint that returns moco and slack status?" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `README.md` | L77-137 |
| `src/config/index.ts` | L6-83 |
| `src/index.ts` | L73-122 |
| `src/index.ts` | L53-96 |
| `docs/DNA_ME_CRM_CURSOR_STEP_BY_STEP_GUIDE.md` | L1495-1560 |
| `src/config/index.ts` | L87-169 |
| `src/index.ts` | L73-96 |
| `src/api/routes/routing.ts` | L27-286 |
| `src/integrations/.gitkeep` | L1 |
| `README.md` | L131-190 |
| `env.example` | L43 |
| `src/index.ts` | L120-187 |
| `src/api/routes/leads.ts` | L99-808 |
| `src/api/routes/routing.ts` | L33-286 |
| `docs/DNA_ME_CRM_CURSOR_STEP_BY_STEP_GUIDE.md` | L1289-1396 |

</details>
</tool-use>

---



---


Lesen der Integrations-Route, um die Implementierung zu verstehen:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/api/routes/integrations.ts</summary>

</details>
</tool-use>

---



---


Prüfe, ob bereits eine Cituro-Integration existiert:


---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** • Searched codebase "**/cituro.ts" • **1** result in **1** directory</summary>

Directory: **e:\dname\crm_dna-me** (1 file)

| File |
|------|
| `src\integrations\cituro.ts` |

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---



---


Prüfe die Cituro-Integration, um verfügbare Methoden zu sehen:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/integrations/cituro.ts</summary>

</details>
</tool-use>

---



---


Erweitere die Backend-Route um Cituro-Status-Endpunkte, dann die Frontend-Komponente:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/integrations/moco.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "getCituroService|cituro" in "src/api/routes/integrations.ts" • 0 matches</summary>

Output mode: content


_No matches found_

</details>
</tool-use>

---



---


Hinzufügen der Cituro-Integration: zuerst Backend-Route erweitern, dann Frontend-Komponente.


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/api/routes/integrations.ts</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -7,4 +7,5 @@
  import { z } from 'zod';
  import { getMocoService } from '../../integrations/moco.js';
+ import { getCituroService } from '../../integrations/cituro.js';
  import { getSyncQueue } from '../../config/queues.js';
  import { db } from '../../db/index.js';
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/api/routes/integrations.ts</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -36,4 +36,5 @@
  export async function integrationsRoutes(fastify: FastifyInstance): Promise&lt;void&gt; {
    const mocoService = getMocoService();
+   const cituroService = getCituroService();
    const syncQueue = getSyncQueue();
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/api/routes/integrations.ts</summary>

**Chunk 1**
Lines added: 25, lines removed: undefined

```diff
@@ -230,4 +230,29 @@
      return customer;
    });
+ 
+   // ===========================================================================
+   // GET /integrations/cituro/status - Check Cituro connection status
+   // ===========================================================================
+ 
+   fastify.get('/integrations/cituro/status', async (_request: FastifyRequest, _reply: FastifyReply) =&gt; {
+     const isConfigured = cituroService.isConfigured();
+     
+     if (!isConfigured) {
+       return {
+         status: 'not_configured',
+         message: 'Cituro API key or subdomain not configured',
+         enabled: config.cituro.enabled
+       };
+     }
+ 
+     const connectionTest = await cituroService.testConnection();
+     
+     return {
+       status: connectionTest.connected ? 'connected' : 'disconnected',
+       message: connectionTest.error || 'Connection successful',
+       enabled: config.cituro.enabled,
+       subdomain: config.cituro.subdomain
+     };
+   });
  
    // ===========================================================================
```

**Chunk 2**
Lines added: 8, lines removed: undefined

```diff
@@ -243,4 +268,12 @@
        mocoConnected = connectionTest.connected;
      }
+ 
+     const cituroConfigured = cituroService.isConfigured();
+     let cituroConnected = false;
+ 
+     if (cituroConfigured) {
+       const connectionTest = await cituroService.testConnection();
+       cituroConnected = connectionTest.connected;
+     }
  
      return {
```

**Chunk 3**
Lines added: 5, lines removed: undefined

```diff
@@ -254,4 +287,9 @@
          connected: false, // Will be implemented in Etappe 12
          enabled: config.features.slackAlerts
+       },
+       cituro: {
+         configured: cituroConfigured,
+         connected: cituroConnected,
+         enabled: config.cituro.enabled
        }
      };
```

</details>

</tool-use>

---



---


Hinzufügen der Frontend-Funktion und Erweitern der Komponente:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/providers/dataProvider.js</summary>

**Chunk 1**
Lines added: 9, lines removed: undefined

```diff
@@ -662,4 +662,13 @@
    return json;
  };
+ 
+ /**
+  * Get Cituro connection status with connection test
+  * @returns {Promise&lt;Object&gt;} Cituro status with connection details
+  */
+ export const getCituroStatus = async () =&gt; {
+   const { json } = await httpClient(&#96;${API_URL}/integrations/cituro/status&#96;);
+   return json;
+ };
  
  /**
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/pages/Settings/IntegrationSettings.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -30,5 +30,5 @@
    Settings as SettingsIcon,
  } from '@mui/icons-material';
- import { getIntegrationsStatus, getMocoStatus } from '../../providers/dataProvider';
+ import { getIntegrationsStatus, getMocoStatus, getCituroStatus } from '../../providers/dataProvider';
  
  // Status color mapping
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/pages/Settings/IntegrationSettings.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -79,4 +79,5 @@
    const [integrationStatus, setIntegrationStatus] = useState(null);
    const [mocoDetails, setMocoDetails] = useState(null);
+   const [cituroDetails, setCituroDetails] = useState(null);
    const [lastRefresh, setLastRefresh] = useState(null);
    const [copySuccess, setCopySuccess] = useState(null);
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/pages/Settings/IntegrationSettings.jsx</summary>

**Chunk 1**
Lines added: 24, lines removed: undefined

```diff
@@ -126,4 +126,28 @@
      }
    };
+ 
+   // Test Cituro connection
+   const testCituroConnection = async () =&gt; {
+     setTestingConnection(true);
+     setError(null);
+     
+     try {
+       const details = await getCituroStatus();
+       setCituroDetails(details);
+       
+       // Also refresh the overall status
+       await fetchStatus(false);
+       
+       if (details.status === 'connected') {
+         // Success notification handled in UI
+       }
+     } catch (err) {
+       console.error('Error testing Cituro connection:', err);
+       setError('Fehler beim Testen der Cituro-Verbindung');
+       setCituroDetails(null);
+     } finally {
+       setTestingConnection(false);
+     }
+   };
  
    // Copy to clipboard
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/pages/Settings/IntegrationSettings.jsx</summary>

**Chunk 1**
Lines added: 2, lines removed: undefined

```diff
@@ -185,6 +185,8 @@
    const mocoStatus = integrationStatus?.moco || {};
    const slackStatus = integrationStatus?.slack || {};
+   const cituroStatus = integrationStatus?.cituro || {};
    const mocoLabel = getStatusLabel(mocoStatus);
    const slackLabel = getStatusLabel(slackStatus);
+   const cituroLabel = getStatusLabel(cituroStatus);
  
    return (
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/pages/Settings/IntegrationSettings.jsx</summary>

**Chunk 1**
Lines added: 127, lines removed: undefined

```diff
@@ -455,4 +455,131 @@
            &lt;/Card&gt;
          &lt;/Grid&gt;
+ 
+         {/* Cituro Integration Card */}
+         &lt;Grid size={{ xs: 12, md: 6 }}&gt;
+           &lt;Card 
+             sx={{ 
+               height: '100%',
+               border: '1px solid',
+               borderColor: cituroStatus.connected ? 'success.main' : 'divider',
+               transition: 'border-color 0.3s ease',
+             }}
+           &gt;
+             &lt;CardContent&gt;
+               {/* Header */}
+               &lt;Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', mb: 2 }}&gt;
+                 &lt;Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5 }}&gt;
+                   &lt;Box
+                     sx={{
+                       width: 40,
+                       height: 40,
+                       borderRadius: 2,
+                       bgcolor: '#6C5CE7',
+                       display: 'flex',
+                       alignItems: 'center',
+                       justifyContent: 'center',
+                       color: '#fff',
+                       fontWeight: 700,
+                       fontSize: '0.875rem',
+                     }}
+                   &gt;
+                     C
+                   &lt;/Box&gt;
+                   &lt;Box&gt;
+                     &lt;Typography variant="subtitle1" fontWeight={600}&gt;
+                       Cituro
+                     &lt;/Typography&gt;
+                     &lt;Typography variant="caption" color="text.secondary"&gt;
+                       Meeting-Buchungen
+                     &lt;/Typography&gt;
+                   &lt;/Box&gt;
+                 &lt;/Box&gt;
+                 &lt;Chip
+                   icon={&lt;StatusIcon status={cituroLabel.status} size="small" /&gt;}
+                   label={cituroLabel.text}
+                   color={getStatusColor(cituroLabel.status)}
+                   size="small"
+                   variant="outlined"
+                 /&gt;
+               &lt;/Box&gt;
+ 
+               &lt;Divider sx={{ my: 2 }} /&gt;
+ 
+               {/* Status Details */}
+               &lt;Box sx={{ display: 'flex', flexDirection: 'column', gap: 1.5 }}&gt;
+                 &lt;Box sx={{ display: 'flex', justifyContent: 'space-between' }}&gt;
+                   &lt;Typography variant="body2" color="text.secondary"&gt;
+                     API konfiguriert:
+                   &lt;/Typography&gt;
+                   &lt;Typography variant="body2" fontWeight={500}&gt;
+                     {cituroStatus.configured ? 'Ja' : 'Nein'}
+                   &lt;/Typography&gt;
+                 &lt;/Box&gt;
+                 
+                 &lt;Box sx={{ display: 'flex', justifyContent: 'space-between' }}&gt;
+                   &lt;Typography variant="body2" color="text.secondary"&gt;
+                     Integration aktiviert:
+                   &lt;/Typography&gt;
+                   &lt;Chip
+                     label={cituroStatus.enabled ? 'Aktiviert' : 'Deaktiviert'}
+                     color={cituroStatus.enabled ? 'success' : 'default'}
+                     size="small"
+                   /&gt;
+                 &lt;/Box&gt;
+ 
+                 {cituroDetails?.subdomain &amp;&amp; (
+                   &lt;Box sx={{ display: 'flex', justifyContent: 'space-between' }}&gt;
+                     &lt;Typography variant="body2" color="text.secondary"&gt;
+                       Subdomain:
+                     &lt;/Typography&gt;
+                     &lt;Typography variant="body2" fontWeight={500} fontFamily="monospace"&gt;
+                       {cituroDetails.subdomain}
+                     &lt;/Typography&gt;
+                   &lt;/Box&gt;
+                 )}
+ 
+                 {cituroDetails?.message &amp;&amp; (
+                   &lt;Alert 
+                     severity={cituroDetails.status === 'connected' ? 'success' : 'warning'} 
+                     sx={{ mt: 1 }}
+                     icon={false}
+                   &gt;
+                     &lt;Typography variant="caption"&gt;{cituroDetails.message}&lt;/Typography&gt;
+                   &lt;/Alert&gt;
+                 )}
+               &lt;/Box&gt;
+ 
+               &lt;Divider sx={{ my: 2 }} /&gt;
+ 
+               {/* Actions */}
+               &lt;Box sx={{ display: 'flex', gap: 1 }}&gt;
+                 &lt;Button
+                   variant="outlined"
+                   size="small"
+                   startIcon={testingConnection ? &lt;CircularProgress size={16} /&gt; : &lt;SyncIcon /&gt;}
+                   onClick={testCituroConnection}
+                   disabled={testingConnection || !cituroStatus.configured}
+                   fullWidth
+                 &gt;
+                   {testingConnection ? 'Teste...' : 'Verbindung testen'}
+                 &lt;/Button&gt;
+               &lt;/Box&gt;
+ 
+               {/* Info Note */}
+               &lt;Paper 
+                 variant="outlined" 
+                 sx={{ mt: 2, p: 1.5, bgcolor: 'action.hover', borderRadius: 1 }}
+               &gt;
+                 &lt;Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 1 }}&gt;
+                   &lt;SettingsIcon fontSize="small" color="action" sx={{ mt: 0.2 }} /&gt;
+                   &lt;Typography variant="caption" color="text.secondary"&gt;
+                     API Key und Subdomain werden via Environment Variables konfiguriert (.env Datei).
+                     Änderungen erfordern einen Server-Neustart.
+                   &lt;/Typography&gt;
+                 &lt;/Box&gt;
+               &lt;/Paper&gt;
+             &lt;/CardContent&gt;
+           &lt;/Card&gt;
+         &lt;/Grid&gt;
  
          {/* Webhook Endpoints Card */}
```

</details>

</tool-use>

---



---



---



---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>

Status: **loading**


</details>
</tool-use>

---



---



---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Error parsing todo list data</summary>

</details>
</tool-use>

---



---



---

