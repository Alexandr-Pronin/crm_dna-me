<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 93fc015b-f169-4b2b-b04e-10dd710e79a2 (2026-01-23 16:25Z) -->

# Chat name generation request (2026-01-23 16:25Z)

_**User (2026-01-23 12:45Z)**_

—Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å –≤—Ç–æ—Ä—É—é –ø—Ä–æ–±–ª–µ–º—É. –∫–∞–∂–¥—ã–π deal –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–ª–∏–µ–Ω—Ç—É. –±–µ–∑ lead deal –Ω–µ –º–æ–∂–µ—Ç —Å—É—â—É—Å—Ç–≤–æ–≤–∞—Ç—å. –Ω—É–∂–Ω–æ –∏–º–µ—Ç—å dropdown –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Ö–æ–∑—è–∏–Ω–∞ deal –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.
–≤ –∫–∞–∂–¥—ã–π stage –∏–∑ –∫–∞–Ω–±–∞–Ω –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É —à–µ—Å—Ç–µ—Ä–µ–Ω–∫—É –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª–∏—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ç—Ä–∏–≥–µ—Ä. –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ. —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ mocoapp –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞ –≤ mocoapp –∏–ª–∏ angebot, —Ç–∞–∫–∂–µ —Ç—Ä–∏–≥–µ—Ä –¥–ª—è cituro —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ —Å —Å—ã–ª–∫–æ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è meeting, –∏–ª–∏ —Ç—Ä–∏–≥–µ—Ä –æ—Ç—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ slack. stage –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ —Ç–æ –µ—Å—Ç—å –∏—Ö –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å , –¥–æ–±–∞–≤–ª—è—Ç—å —É–¥–∞–ª—è—Ç—å –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã. –∫–∫–æ–Ω–µ—á–µ–Ω–æ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ —Ö—ä—Ä–∞–Ω–∏—Ç—Å—è –≤ –±–∞—Ö–µ –¥–∞–Ω–Ω—ã—Ö. –≤ –º–µ–Ω—é –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∏—Å—å–º–∞ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–≤–∞—Ç—å—Å—è –≤ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö —Ü–µ–ª—è—Ö –¥–ª—è –ø—Ä–æ–≥—Ä–µ–≤–∞. –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–æ–∑–¥–∞—Ç—å —Ü–µ–ø–æ—á–∫—É –ø–∏—Å–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö. –µ—â—ë –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω–≥–µ—Ä–∞—Ü–∏–∏ api —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å cituro. –Ω—É–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å Reports-Seite
Settings-Seite (teilweise)
# DNA ME CRM - Complete Implementation Roadmap

You are a senior fullstack developer building a modern B2B CRM.

## CONTEXT
- Company: DNA ME (biotech, genomic sequencing services)
- Stack: TypeScript/Fastify (backend), React/React Admin (frontend), PostgreSQL, Redis/BullMQ
- Current state: Basic CRM exists (leads, deals, kanban, scoring engine)
- Goal: Add missing critical features to make it production-ready

## EXISTING INFRASTRUCTURE
‚úÖ Database: Leads, Deals, Events, Pipelines, Organizations, Tasks tables
‚úÖ API: CRUD endpoints for all entities
‚úÖ Workers: Event processing, score decay, Moco/Slack sync
‚úÖ UI: Kanban board, lead list, deal list
‚úÖ Integrations: Moco (invoicing), Slack (notifications)

## ACTUAL LEAD SOURCES (NO ROI CALCULATOR)

### 1. Landing Page Forms
We have 3 forms on landing page:
- **Contact form:** name, email, company, question ‚Üí form_type='contact'
- **PDF download:** email only ‚Üí form_type='pdf_download', lead_magnet='ngs_guide'
- **Callback request:** name, phone, preferred_time ‚Üí form_type='callback_request'

All forms POST to: https://crm.dna-me.com/api/leads/capture

### 2. LinkedIn Posts with UTM Links
- Organic LinkedIn posts link to landing page
- Format: https://dna-me.com?utm_source=linkedin&utm_campaign=microbiome_jan26
- NO LinkedIn API - only UTM tracking

### 3. Manual Lead Entry
- BDR manually adds leads from LinkedIn connections
- Auto-enrich email with Hunter.io

### 4. Conference Badge Scans
- CSV upload after offline events
- Bulk create leads

### 5. Cold Email (future)
- Via Lemlist
- Webhook integration for tracking

---

## ROADMAP: 8 WEEKS TO LAUNCH

### WEEK 1: Lead Capture & UTM Tracking

#### 1.1 Form Capture Endpoint
**Backend: POST /api/leads/capture**

Handle 3 form types:
1. `form_type='contact'` ‚Üí create lead, task for BDR, Slack notification
2. `form_type='pdf_download'` ‚Üí create lead, email PDF, +10 score
3. `form_type='callback_request'` ‚Üí create lead, task "Call back", +15 score

**Actions on every form submit:**
- Capture UTM (source, campaign)
- Create lead (or update if email exists)
- Auto-reply email "Thanks, we'll contact you"
- Slack notification to #leads channel

**Database migration needed:**
```sql
ALTER TABLE leads ADD COLUMN lead_magnet VARCHAR(50);
ALTER TABLE leads ADD COLUMN preferred_callback_time VARCHAR(50);
```

#### 1.2 Anonymous Visitor Tracking
**JavaScript snippet for landing page:**
- Generate visitor_id (localStorage)
- Track page views before form submit
- Link visitor_id to lead on form submit

**Database table:**
```sql
CREATE TABLE anonymous_visitors (
  id UUID PRIMARY KEY,
  visitor_id VARCHAR(36) UNIQUE,
  first_seen TIMESTAMP,
  page_views INTEGER DEFAULT 0,
  utm_source VARCHAR(50),
  utm_campaign VARCHAR(100),
  converted_to_lead_id UUID REFERENCES leads(id)
);
```

#### 1.3 UTM Performance Dashboard
**Frontend: /utm-performance page**

Show table:
| Campaign | Visitors | Form Submits | Conversion % | Leads |
|----------|----------|--------------|--------------|-------|
| microbiome_jan26 | 47 | 12 | 25.5% | [12 leads ‚Üí] |

**SQL query:**
```sql
SELECT 
  utm_campaign,
  COUNT(DISTINCT visitor_id) as visitors,
  COUNT(DISTINCT converted_to_lead_id) as form_submits,
  ROUND(COUNT(DISTINCT converted_to_lead_id)::numeric / COUNT(DISTINCT visitor_id) * 100, 1) as conversion_rate
FROM anonymous_visitors
GROUP BY utm_campaign;
```

#### 1.4 Auto-Reply Email Service
**Backend: emailService.sendAutoReply()**

Templates:
- Contact form: "Thanks for your question. We'll respond in 24h"
- PDF download: "Here's your guide" + PDF attachment
- Callback: "We'll call you at [preferred_time]"

Use SendGrid or Amazon SES.

**ENV vars needed:**
```
SMTP_HOST=smtp.sendgrid.net
SMTP_USER=apikey
SMTP_PASS=SG.xxxx
SMTP_FROM=info@dna-me.com
```

---

### WEEK 2: Email Sequences & Automation

#### 2.1 Email Sequences Database
**Tables:**
```sql
CREATE TABLE email_sequences (
  id UUID PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  trigger_event VARCHAR(50), -- 'contact_form', 'pdf_download', 'callback_request'
  active BOOLEAN DEFAULT true,
  emails JSONB -- [{delay_days: 0, subject: '...', body: '...'}]
);

CREATE TABLE sequence_enrollments (
  id UUID PRIMARY KEY,
  lead_id UUID REFERENCES leads(id),
  sequence_id UUID REFERENCES email_sequences(id),
  current_step INTEGER DEFAULT 0,
  status VARCHAR(20) DEFAULT 'active',
  enrolled_at TIMESTAMP,
  last_email_sent_at TIMESTAMP,
  UNIQUE(lead_id, sequence_id)
);
```

#### 2.2 Email Sequence Builder UI
**Frontend: /email-sequences page**

Features:
- List all sequences
- Create/edit sequence
- For each email: delay_days, subject, body (rich text editor)
- Variables: {{first_name}}, {{company_name}}
- Preview timeline: "Day 0 ‚Üí Day 3 ‚Üí Day 7"
- Test mode: send to yourself

#### 2.3 Email Sequence Worker
**Backend: workers/emailSequenceWorker.ts**

Cron job every 15 minutes:
1. Fetch active enrollments
2. Check if email is due (daysSinceLastEmail >= delay_days)
3. Send email
4. Update current_step, last_email_sent_at
5. If all emails sent ‚Üí status = 'completed'

#### 2.4 Default Sequences (Seed Data)
**Create 3 sequences:**

1. **Contact Form Follow-up**
   - Day 0: "Thanks, we'll respond soon"
   - Day 3: "Here's how we help labs like {{company_name}}"
   - Day 7: "Sample report attached"

2. **PDF Download Nurture**
   - Day 0: "Your NGS guide" + PDF
   - Day 5: "Case study: BioTech Lab reduced TAT by 70%"
   - Day 10: "Ready to try? Book a call"

3. **Callback Follow-up**
   - Day 0: "We'll call you at {{preferred_callback_time}}"
   - Day 1 (if not reached): "We tried to call - reschedule?"

#### 2.5 Email Tracking
**Open tracking:** 1px image in footer
**Click tracking:** rewrite links to /track/:link_id

Update lead score:
- Email opened: +1 point
- Link clicked: +3 points

---

### WEEK 3: Manual Lead Entry & CSV Import

#### 3.1 Quick Add Lead Modal
**Frontend: QuickAddLead component**

Fields:
- First name, Last name
- LinkedIn URL (optional)
- Company
- Source dropdown: LinkedIn, Conference, Referral, Other

**On submit:**
1. Create lead
2. If LinkedIn URL provided ‚Üí trigger Hunter.io email finder
3. Create task for BDR: "Send connection request"

#### 3.2 Hunter.io Integration
**Backend: services/hunterService.ts**
```typescript
async function findEmail(firstName: string, lastName: string, domain: string) {
  const response = await fetch('https://api.hunter.io/v2/email-finder', {
    params: {
      domain,
      first_name: firstName,
      last_name: lastName,
      api_key: process.env.HUNTER_API_KEY
    }
  });
  
  const { data } = await response.json();
  return {
    email: data.email,
    confidence: data.score // 0-100
  };
}
```

**UI on lead card:**
```tsx
{!lead.email && (
  <Button onClick={() => findEmail(lead.id)}>
    üîç Find Email (Hunter.io)
  </Button>
)}

{lead.emailConfidence && (
  <Badge color={lead.emailConfidence > 90 ? 'green' : 'yellow'}>
    Confidence: {lead.emailConfidence}%
  </Badge>
)}
```

**ENV var:**
```
HUNTER_API_KEY=xxx
```

**Cost tracking:** Show "API credits used: 45/500 this month"

#### 3.3 CSV Import
**Frontend: /import page**

Features:
- Upload CSV file
- Map columns: "Name" ‚Üí first_name, "Email" ‚Üí email, etc
- Preview first 5 rows
- Set bulk properties: source='conference_feb_2026'
- Background job for large files (1000+ rows)

**Backend: POST /api/leads/import**
```typescript
async function importLeads(csvData: Row[], source: string) {
  const results = { created: 0, duplicates: 0, errors: 0 };
  
  for (const row of csvData) {
    try {
      const existing = await prisma.lead.findUnique({ 
        where: { email: row.email } 
      });
      
      if (existing) {
        results.duplicates++;
        continue;
      }
      
      await prisma.lead.create({
        data: {
          firstName: row.first_name,
          lastName: row.last_name,
          email: row.email,
          company: { connectOrCreate: {...} },
          source,
          score: 5 // +5 for conference attendance
        }
      });
      
      results.created++;
    } catch (error) {
      results.errors++;
    }
  }
  
  return results;
}
```

---

### WEEK 4: Task Management & Lead Routing

#### 4.1 Auto-Task Creation
**Triggers:**
1. Contact form submitted ‚Üí Task: "Answer question within 24h"
2. PDF downloaded ‚Üí Task: "Follow up on PDF download" (after 3 days)
3. Callback requested ‚Üí Task: "Call back at [time]"
4. Manual lead added ‚Üí Task: "Send LinkedIn connection"
5. Email opened 3x ‚Üí Task: "Hot lead - call now"

**Database:**
```sql
ALTER TABLE tasks ADD COLUMN auto_created BOOLEAN DEFAULT false;
ALTER TABLE tasks ADD COLUMN trigger_event VARCHAR(50);
```

#### 4.2 Smart Lead Routing
**Rules:**
- Score < 40 ‚Üí Unassigned (nurture only)
- Score 40-80 ‚Üí BDR (by region)
- Score > 80 ‚Üí AE
- Interest='b2b_partnership' ‚Üí AE (regardless of score)

**Implementation:**
```typescript
async function assignOwner(lead: Lead) {
  let ownerId = null;
  
  if (lead.score < 40) {
    ownerId = null; // nurture automation only
  } else if (lead.score >= 80 || lead.productInterest.includes('b2b_partnership')) {
    ownerId = AE_USER_ID;
  } else {
    // Assign to BDR based on country
    ownerId = lead.country === 'DE' ? BDR_GERMANY_ID : BDR_LATAM_ID;
  }
  
  await prisma.lead.update({
    where: { id: lead.id },
    data: { ownerId }
  });
}
```

Call `assignOwner()` on:
- Lead create
- Score update
- Product interest change

#### 4.3 Task Queue UI
**Frontend: /tasks page**

Filters:
- My tasks
- Overdue
- By priority (High/Medium/Low)
- By lead

Quick actions:
- Mark done
- Snooze (1 day, 3 days, 1 week)
- Reassign to teammate

---

### WEEK 5: Analytics & Reporting

#### 5.1 Sales Funnel Report
**Endpoint: GET /api/analytics/funnel?pipeline=research_lab**

Return:
```json
{
  "stages": [
    { "stage": "cold", "count": 100, "conversion_to_next": 35 },
    { "stage": "warm", "count": 35, "conversion_to_next": 15 },
    { "stage": "hot", "count": 15, "conversion_to_next": 8 },
    { "stage": "proposal", "count": 8, "conversion_to_next": 3 },
    { "stage": "won", "count": 3 }
  ],
  "overall_conversion": 3,
  "avg_time_per_stage": { "cold": 7, "warm": 5, "hot": 3, "proposal": 10 }
}
```

**UI:** Funnel chart showing drop-off

#### 5.2 Source Performance Report
**Endpoint: GET /api/analytics/sources**

Return:
```json
{
  "sources": [
    {
      "source": "linkedin",
      "total_leads": 50,
      "won_deals": 5,
      "win_rate": 10,
      "avg_deal_size": 2000,
      "total_revenue": 10000
    },
    {
      "source": "conference_feb_2026",
      "total_leads": 23,
      "won_deals": 8,
      "win_rate": 34.8,
      "avg_deal_size": 3500,
      "total_revenue": 28000
    }
  ]
}
```

**UI:** Table + bar chart

#### 5.3 Lead Score Distribution
**Histogram:** Show how many leads in each score range
```
0-20:  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 120 leads
21-40: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 80 leads
41-60: ‚ñà‚ñà‚ñà‚ñà‚ñà 50 leads
61-80: ‚ñà‚ñà‚ñà 30 leads
81+:   ‚ñà‚ñà 20 leads
```

Alert if 80%+ are cold ‚Üí "Need more marketing!"

#### 5.4 Revenue Forecast
**Weighted pipeline:**
```
Pipeline value = SUM(deal_amount √ó probability)
```

Probability by stage:
- Cold: 10%
- Warm: 25%
- Hot: 50%
- Proposal: 75%
- Won: 100%

Show: "Expected revenue this quarter: ‚Ç¨45,000"

---

### WEEK 6: Multi-Pipeline & Activity Timeline

#### 6.1 Multi-Pipeline Support
**Database constraint:**
```sql
ALTER TABLE deals 
ADD CONSTRAINT unique_lead_per_pipeline 
UNIQUE (lead_id, pipeline);
```

**UI on LeadDetails:**
Show all active deals:
```tsx
<Card title="Active Deals">
  {lead.deals.map(deal => (
    <div key={deal.id}>
      <Badge>{deal.pipeline}</Badge>
      <span>{deal.stage}</span>
      <div>‚Ç¨{deal.amount}</div>
      <div>Owner: {deal.owner?.name}</div>
      <Button onClick={() => openKanban(deal.pipeline)}>
        View Pipeline ‚Üí
      </Button>
    </div>
  ))}
  
  <Button onClick={() => createDeal(lead.id)}>
    + Add to Pipeline
  </Button>
</Card>
```

#### 6.2 Unified Activity Timeline
**Endpoint: GET /leads/:id/timeline**

Combine:
- Activities (calls, meetings, notes)
- Events (email opens, page views)
- Deal updates (stage changes)
- Task completions

Return chronological feed:
```json
[
  {
    "type": "email_opened",
    "timestamp": "2026-01-23T10:30:00Z",
    "subject": "Opened: 'How we help labs'",
    "icon": "üìß"
  },
  {
    "type": "deal_update",
    "timestamp": "2026-01-23T09:15:00Z",
    "subject": "Deal moved: Research Lab ‚Üí Hot",
    "icon": "üìà"
  },
  {
    "type": "task_completed",
    "timestamp": "2026-01-22T16:00:00Z",
    "subject": "Task completed: Called lead",
    "icon": "‚úÖ"
  }
]
```

**UI:** Timeline component with icons

---

### WEEK 7: Advanced Features

#### 7.1 Link Shortener (for LinkedIn posts)
**Create tracked links in CRM:**

**Frontend: /link-shortener**
```tsx
<Form>
  <Input label="Destination" value="https://dna-me.com/contact" />
  <Select label="Campaign" options={campaigns} />
  <Button>Generate Link</Button>
</Form>

<Output>
  Short link: https://dna-me.com/go/abc123
  Stats: 47 clicks, 12 conversions (25.5%)
</Output>
```

**Backend:**
```sql
CREATE TABLE tracked_links (
  id UUID PRIMARY KEY,
  short_code VARCHAR(10) UNIQUE,
  destination_url TEXT,
  utm_source VARCHAR(50),
  utm_campaign VARCHAR(100),
  clicks INTEGER DEFAULT 0,
  conversions INTEGER DEFAULT 0
);
```

**Redirect: GET /go/:code**
- Log click
- Redirect to destination + UTM params

#### 7.2 Saved Filters & Segments
**UI:** Save current filter state as segment

Example segments:
- "Hot leads in Germany"
- "B2B interest, unassigned"
- "Conference leads not contacted"

**Database:**
```sql
CREATE TABLE segments (
  id UUID PRIMARY KEY,
  name VARCHAR(255),
  filters JSONB,
  user_id UUID,
  shared BOOLEAN DEFAULT false
);
```

Quick access dropdown: "My Segments"

#### 7.3 Bulk Actions
**Select multiple leads ‚Üí actions:**
- Assign to owner
- Add to sequence
- Add tags
- Export to CSV

Show progress: "Processing 45 leads... 23/45 done"

#### 7.4 Comments & @Mentions
**On lead/deal cards:**
- Add comment
- @mention teammate ‚Üí notification
- Show in activity timeline

---

### WEEK 8: Polish & Launch

#### 8.1 Mobile Responsive UI
- Optimize kanban for mobile (swipe cards)
- Quick actions: tap to call, email
- Mobile-friendly forms

#### 8.2 Notification Center
**In-app notifications:**
- Bell icon with unread count
- List: "Hans Mueller became hot lead"
- Mark as read
- Link to lead/deal

**Slack integration for critical only:**
- Hot lead (score > 80)
- Deal won
- Task overdue

#### 8.3 Testing
- Unit tests for scoring engine
- Integration tests for webhooks
- E2E tests for critical flows (form submit ‚Üí lead create)

#### 8.4 Documentation
- README with setup instructions
- API documentation (Swagger/OpenAPI)
- User guide for BDR/AE

#### 8.5 Deployment
- Docker Compose for production
- Environment variables documented
- Database backups automated
- Health check endpoint

---

## TECHNICAL REQUIREMENTS

### Code Quality
- TypeScript strict mode
- Error handling: try/catch everywhere
- Validation: Zod schemas for all inputs
- Logging: Winston (backend), console (frontend)

### Performance
- Database indexes on: email, score, utm_campaign, pipeline+stage
- Pagination: max 50 items per request
- Background jobs for: CSV import, email sending, enrichment
- Redis caching for: lead counts, analytics

### Security
- JWT authentication
- Rate limiting: 100 req/min per IP
- CORS: whitelist frontend domain
- Webhook signatures (HMAC)
- Parameterized queries (prevent SQL injection)

### Environment Variables
```env
DATABASE_URL=postgresql://...
REDIS_URL=redis://...
JWT_SECRET=xxx
SMTP_HOST=smtp.sendgrid.net
SMTP_USER=apikey
SMTP_PASS=SG.xxx
HUNTER_API_KEY=xxx
SLACK_WEBHOOK_URL=https://hooks.slack.com/...
MOCO_API_KEY=xxx
```

---

## FILE STRUCTURE
```
backend/
  src/
    routes/
      leads.ts          # POST /api/leads/capture
      webhooks.ts       # External webhooks
      analytics.ts      # Reports
      sequences.ts      # Email sequences CRUD
    services/
      emailService.ts   # SendGrid integration
      hunterService.ts  # Email finder
      slackService.ts   # Notifications
    workers/
      emailSequenceWorker.ts  # Cron job
      scoreDecayWorker.ts     # Existing
    migrations/
      001_add_lead_magnet.sql
      002_create_sequences.sql
      003_create_anonymous_visitors.sql

frontend/
  src/
    pages/
      UTMPerformance.tsx
      EmailSequences.tsx
      Import.tsx
      LinkShortener.tsx
    components/
      QuickAddLead.tsx
      ActivityTimeline.tsx
      ScoreBreakdown.tsx
```

---

## START INSTRUCTIONS

1. Copy this entire prompt into Cursor
2. Say: **"Start with Week 1, Task 1.1: Create POST /api/leads/capture endpoint"**
3. After each file generated, say: **"Continue"**
4. At end of week, say: **"Week 1 complete. Show checklist to test features."**
5. Test thoroughly before moving to Week 2

---

## SUCCESS METRICS

After 8 weeks, you should have:
- ‚úÖ All 3 landing page forms capturing leads
- ‚úÖ UTM tracking working (know which LinkedIn post converted)
- ‚úÖ Email sequences sending automatically
- ‚úÖ BDR receiving tasks for new leads
- ‚úÖ Analytics dashboard showing funnel, sources, forecast
- ‚úÖ Multi-pipeline support (1 lead in 3 deals)
- ‚úÖ Hunter.io finding emails for LinkedIn leads
- ‚úÖ CSV import for conference badges
- ‚úÖ Slack notifications for hot leads
- ‚úÖ Production-ready deployment

Good luck! üöÄ

---

_**Agent (model claude-4.5-opus-high-thinking, mode Plan)**_

<think><details><summary>Thought Process</summary>
Der Benutzer hat eine umfangreiche Anfrage mit mehreren Funktionen, die implementiert werden m√ºssen. Lassen Sie mich die Anforderungen zusammenfassen:

1. **Deal-Kunden-Zuordnung**: Jeder Deal muss an einen Kunden (Lead) gebunden sein, mit einem Dropdown zur √Ñnderung des Eigent√ºmers
2. **Stage-Trigger (Zahnrad-Button)**: In jedem Kanban-Stage eine Schaltfl√§che f√ºr Aktionen wie:
   - E-Mail schreiben
   - Projekt in Mocoapp erstellen
   - Kunde in Mocoapp erstellen
   - Angebot erstellen
   - Cituro-Integration (Meeting-Link senden)
   - Slack-Nachricht senden
3. **Adaptive Stages**: Stages k√∂nnen ge√§ndert, hinzugef√ºgt, gel√∂scht werden + neue Pipelines erstellen
4. **E-Mail-Marketing-Men√º**: Tabelle f√ºr automatische E-Mail-Ketten (Warm-up)
5. **Cituro API-Integration**
6. **Reports-Seite fertigstellen**
7. **Settings-Seite (teilweise)**

Dies ist ein sehr gro√ües Projekt. Ich sollte zuerst den aktuellen Code untersuchen, um zu verstehen, was bereits existiert und was fehlt.

Lass mich die relevanten Dateien lesen und die Struktur verstehen.</details></think>

---

Ich werde zuerst den aktuellen Code untersuchen, um die bestehende Struktur zu verstehen und einen detaillierten Plan zu erstellen.

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\frontend\src\components\Kanban\KanbanColumn.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\frontend\src\components\Kanban\KanbanBoard.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\frontend\src\components\Kanban\DealCard.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ich habe jetzt einen √úberblick √ºber die Kanban-Komponenten. Jetzt muss ich das Backend und die Datenbankstruktur untersuchen, um zu sehen, wie Pipelines, Stages und Deals aktuell implementiert sind.</details></think>

---

Model provided non-existent directory

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** ‚Ä¢ Searched codebase "**/migrations/*.sql" ‚Ä¢ **3** results in **1** directory</summary>

Directory: **e:\dname\crm_dna-me** (3 files)

| File |
|------|
| `migrations\1737575200000_add_deal_position.sql` |
| `migrations\1737475200001_seed-pipelines.sql` |
| `migrations\1737475200000_initial-schema.sql` |

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ich muss das Backend-Verzeichnis finden und die bestehenden Migrationen, Routen und Services untersuchen.</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\migrations\1737475200000_initial-schema.sql</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\frontend\src\pages\Reports\index.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\frontend\src\pages\Settings\index.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Jetzt verstehe ich die Struktur besser. Ich muss noch weitere Dateien untersuchen:
1. Backend-Routen und Services
2. Bestehende Integrations-Settings
3. Email Sequences (falls vorhanden)
4. Das Menu/Layout

Lassen Sie mich weitere Dateien lesen.</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\frontend\src\pages\Settings\IntegrationSettings.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ich habe jetzt einen guten √úberblick √ºber die Codestruktur. Lassen Sie mich noch ein paar weitere Dateien lesen, um die vollst√§ndige Struktur zu verstehen:

1. Das Menu (um zu verstehen, wo der neue Men√ºpunkt hinzugef√ºgt werden soll)
2. Die Deals-Ressourcen
3. Die Pipeline-Services
4. Die vorhandenen API-Routen</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\frontend\src\components\layout\Menu.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\src\services\pipelineService.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\src\api\routes\pipelines.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Gut, ich habe jetzt ein umfassendes Verst√§ndnis der Codebase. Lassen Sie mich noch die Deal-Services und -Routen sowie die Automation-Services lesen, um den Plan zu vervollst√§ndigen.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\src\services\dealService.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\src\api\routes\automation.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: e:\dname\crm_dna-me\frontend\src\resources\deals\DealEdit.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ich habe jetzt ein gutes Verst√§ndnis der gesamten Codebase. Lassen Sie mich alle Anforderungen des Benutzers zusammenfassen und einen strukturierten Plan erstellen:

Anforderungen:
1. **Deal-Lead Zuordnung** - Jeder Deal muss an einen Lead gebunden sein (existiert bereits √ºber `lead_id`), aber es fehlt ein Dropdown zum √Ñndern des Lead-Eigent√ºmers
2. **Stage-Trigger (Zahnrad-Button)** - F√ºr jeden Kanban-Stage eine Aktions-Schaltfl√§che mit Optionen:
   - E-Mail schreiben
   - Projekt in Mocoapp erstellen
   - Kunde in Mocoapp erstellen
   - Angebot erstellen
   - Cituro-Integration (Meeting-Link senden)
   - Slack-Nachricht senden
3. **Adaptive Stages** - Stages k√∂nnen ge√§ndert, hinzugef√ºgt, gel√∂scht werden + neue Pipelines erstellen
4. **E-Mail-Marketing-Men√º** - Neue Seite f√ºr automatische E-Mail-Ketten (Warm-up/Nurturing)
5. **Cituro API-Integration** - Neue Integration hinzuf√ºgen
6. **Reports-Seite fertigstellen** - Aktuell nur Mock-Daten
7. **Settings-Seite (teilweise)** - Einige Bereiche fehlen

Das ist ein sehr umfangreiches Projekt. Ich sollte den Benutzer fragen, welche Priorit√§ten er setzen m√∂chte, da dies mehrere Wochen Arbeit sein k√∂nnte.

Aber zun√§chst sollte ich einen umfassenden Plan erstellen, der alle Anforderungen abdeckt.

Die Datenbank hat bereits:


- `deals` Tabelle mit `lead_id` (NOT NULL)
- `pipeline_stages` Tabelle mit `automation_config` JSONB
- `automation_rules` Tabelle f√ºr Trigger-Konfiguration
- `email_sequences` und `sequence_enrollments` Tabellen sind im Roadmap erw√§hnt, aber existieren noch nicht

Jetzt erstelle ich einen detaillierten Implementierungsplan f√ºr alle Anforderungen.</details></think>

---

Ich habe jetzt einen umfassenden √úberblick √ºber die Codebase. Das ist ein sehr umfangreiches Projekt mit mehreren gro√üen Features. Lassen Sie mich einige kl√§rende Fragen stellen, um den Plan optimal zu gestalten:

---

<tool-use data-tool-type="unknown" data-tool-name="ask_question">
<details>
<summary>Tool use: **ask_question**</summary>


Parameters:

```json
{
  "title": "Priorisierung der Features",
  "questions": [
    {
      "id": "priority",
      "prompt": "Welche Features haben die h√∂chste Priorit√§t und sollen zuerst implementiert werden?",
      "options": [
        {
          "id": "deal_lead",
          "label": "Deal-Lead Zuordnung (Dropdown zum √Ñndern des Leads)"
        },
        {
          "id": "stage_triggers",
          "label": "Stage-Trigger mit Zahnrad-Button (Moco, Cituro, Slack)"
        },
        {
          "id": "adaptive_stages",
          "label": "Adaptive Stages/Pipelines (CRUD-Operationen)"
        },
        {
          "id": "email_marketing",
          "label": "E-Mail-Marketing/Nurturing-Sequenzen"
        },
        {
          "id": "reports",
          "label": "Reports-Seite fertigstellen"
        },
        {
          "id": "cituro_api",
          "label": "Cituro API-Integration"
        }
      ],
      "allowMultiple": true
    },
    {
      "id": "cituro_docs",
      "prompt": "Haben Sie die Cituro API-Dokumentation oder Zugangsdaten verf√ºgbar?",
      "options": [
        {
          "id": "yes",
          "label": "Ja, ich habe die API-Doku/Credentials"
        },
        {
          "id": "no",
          "label": "Nein, erstmal nur vorbereiten/Mock"
        }
      ]
    },
    {
      "id": "email_service",
      "prompt": "Welchen E-Mail-Service m√∂chten Sie f√ºr die Marketing-Sequenzen nutzen?",
      "options": [
        {
          "id": "sendgrid",
          "label": "SendGrid"
        },
        {
          "id": "ses",
          "label": "Amazon SES"
        },
        {
          "id": "smtp",
          "label": "Generischer SMTP"
        },
        {
          "id": "mock",
          "label": "Erstmal nur Mock/Placeholder"
        }
      ]
    }
  ]
}
```
Additional data:

```json
{
  "status": "pending"
}
```
Status: **completed**


</details>
</tool-use>

---



---

